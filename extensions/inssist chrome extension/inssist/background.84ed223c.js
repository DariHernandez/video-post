!function(){var e=parcelRequire("5qYyF"),t=parcelRequire("3vFge"),s=parcelRequire("1dUCr"),a=parcelRequire("6HIpl"),n=parcelRequire("2ANrW"),o=parcelRequire("79MGz"),r=parcelRequire("6cJJe"),i=parcelRequire("7IK79"),l=parcelRequire("41o7n"),u=parcelRequire("5PEJk"),c=parcelRequire("2dFhf"),d=parcelRequire("77cTM"),f=parcelRequire("49cB4"),g=parcelRequire("0T27i"),h=parcelRequire("7JXhk"),p=parcelRequire("4cvky"),m=parcelRequire("52AdD"),w=parcelRequire("3ES69"),v=parcelRequire("3eF7s"),b=parcelRequire("3H7Qv"),y=parcelRequire("5lkrH"),S=parcelRequire("2HMmb"),k=parcelRequire("3Nb6A"),I=parcelRequire("23iSV"),T=parcelRequire("buqp1"),P=parcelRequire("20Rbg"),C=parcelRequire("5Up1d"),A=parcelRequire("2D8Wr"),R=parcelRequire("3YcAe"),U=parcelRequire("3kGit"),x=parcelRequire("hjz9P"),F=parcelRequire("3iAZ3"),O=parcelRequire("1urpI"),q=parcelRequire("1q3xQ"),D=parcelRequire("57o7k"),_=parcelRequire("7uF82"),N=parcelRequire("2ZQ5r"),E=parcelRequire("1DWsf"),B=parcelRequire("4qojt"),L=parcelRequire("3WG9L"),M=parcelRequire("3L1Ef"),H=parcelRequire("6f1FD"),j=parcelRequire("7y7Q8"),J=parcelRequire("6NEmR"),V=parcelRequire("5alaC"),G=parcelRequire("2jzw2"),W=parcelRequire("6lf2s"),z=parcelRequire("1bqdf"),K=parcelRequire("1tK6z"),$=parcelRequire("12ldH");function Q(e){Object.defineProperty(e,"__esModule",{value:!0})}({maxFakeId:2147483647,lastFakeId:0,fakeIdToCallback:{},init(){this._setupWorker("/js/hack-timer-worker.min.js")},_getFakeId(){do{this.lastFakeId===this.maxFakeId?this.lastFakeId=0:this.lastFakeId++}while(this.fakeIdToCallback.hasOwnProperty(this.lastFakeId));return this.lastFakeId},_setupWorker(e){const t={},s="hack-timer-worker:";let a;try{a=new Worker(e),window.setInterval=(e,s)=>{const n=this._getFakeId();return t[n]={callback:e,parameters:Array.prototype.slice.call(arguments,2)},a.postMessage({name:"setInterval",fakeId:n,time:s}),n},window.clearInterval=e=>{t.hasOwnProperty(e)&&(delete t[e],a.postMessage({name:"clearInterval",fakeId:e}))},window.setTimeout=(e,s)=>{const n=this._getFakeId();return t[n]={callback:e,parameters:Array.prototype.slice.call(arguments,2),isTimeout:!0},a.postMessage({name:"setTimeout",fakeId:n,time:s}),n},window.clearTimeout=e=>{t.hasOwnProperty(e)&&(delete t[e],a.postMessage({name:"clearTimeout",fakeId:e}))},a.onmessage=e=>{const a=e.data.fakeId;let n,o,r;if(t.hasOwnProperty(a)&&(n=t[a],r=n.callback,o=n.parameters,n.hasOwnProperty("isTimeout")&&n.isTimeout&&delete t[a]),"string"==typeof r)try{r=new Function(r)}catch(e){console.log(s+" error parsing callback code string: ",error)}"function"==typeof r&&r.apply(window,o)},a.onerror=e=>{console.log(e)},console.log(s+" initialisation succeeded")}catch(e){console.log(s+" initialisation failed"),console.log(e)}}}).init();class Y{constructor(e){this.defaultDelay=e,this.queue=Promise.resolve(),this.totalTasks=0,this.cleanupIndex=-1}addTask(e,t){const s=this.totalTasks++;return new Promise(((a,n)=>{this.queue=this.queue.then((async()=>{if(s<=this.cleanupIndex)t?a(await t()):a();else try{a(await e())}catch(e){n(e)}})),this.defaultDelay&&this.addDelay(this.defaultDelay)}))}addDelay(e){const t=this.totalTasks++;return new Promise((s=>{this.queue=this.queue.then((async()=>{t<=this.cleanupIndex||await $().default(e),s()}))}))}enqueueTask(e,t){const s=this.totalTasks++;return this.queue=this.queue.then((async()=>{if(s<=this.cleanupIndex)t&&await t();else try{await e()}catch(e){}})),this.defaultDelay&&this.enqueueDelay(this.defaultDelay),this}enqueueDelay(e){const t=this.totalTasks++;return this.queue=this.queue.then((async()=>{t<=this.cleanupIndex||await $().default(e)})),this}cleanup(){this.cleanupIndex=this.totalTasks-1}}function Z(e){return"[object Object]"===Object.prototype.toString.call(e)}var X="fb-api.fb-error",ee="fb-api.failed-to-fetch-lsd-code",te="fb-api.failed-to-fetch-state-code",se="fb-api.auth-window-closed-by-user",ae="fb-api.no-connected-fb-page",ne="fb-api.unknown",oe={isError:function(e,t=null){return e&&e[re]&&(!t||e.code===t)},checkAuth:ce((async function e(t=!0){let s;try{K().fetcher.ignoreCache(),s=await K().fetcher.fetch("https://www.facebook.com/settings?tab=your_facebook_information")}catch(s){return t?e(!1):(z().sentryController.sendError("fbApi.checkAuth: failed","error",{details:s},{actor:"fb-api"}),!1)}if(s.redirected)return!1;return!0}),"check-auth"),logoutFcs:ce((async function(){var e;K().fetcher.ignoreCache();const t=await K().fetcher.fetchText("https://business.facebook.com/creatorstudio"),s=(null===(e=t.match(/"logoutToken":"([^"]*)"/))||void 0===e?void 0:e[1])||null;s&&(K().fetcher.ignoreCache(),await K().fetcher.fetch("https://business.facebook.com/logout.php?h="+s))}),"logout-fcs"),connectToFcs:ce((async function(){var e,t;K().fetcher.ignoreCache();const s="https://business.facebook.com/creatorstudio",a=await K().fetcher.fetchText(s),n=await le(a),o=/"LSD"[^"]*"token":"([^"]*)"/;let r=a;o.test(r)||(K().fetcher.ignoreCache(),r=await K().fetcher.fetchText(s));const i=(null===(e=r.match(o))||void 0===e?void 0:e[1])||null;if(!i)throw ie({code:ee,html:r});const l=await ue({url:"https://business.facebook.com/business_user/oauth/state/?type=3",body:{lsd:i}}),u=null==l||null===(t=l.payload)||void 0===t?void 0:t.state;if(!u)throw ie({code:te,lsdCode:i,stateResponse:l});const c=await W().chromeBus.send("fb-api.auth-fcs",{appId:n,stateCode:u});if(!c)throw ie({code:se});await ue({url:"https://business.facebook.com/media_manager/instagram/oauthlink/update/",body:{code:c}})}),"connect-to-fcs"),connectToFcsWithCrossposting:ce((async function(){var e,t;K().fetcher.ignoreCache();const s=await K().fetcher.fetchText("https://business.facebook.com/creatorstudio"),a=await le(s,{withCrossposting:!0}),n=await ue({url:"https://business.facebook.com/media_manager/instagram/oauth_state/",incognito:!0}),o=null==n||null===(e=n.payload)||void 0===e?void 0:e.state;if(!o)throw ie({code:te,stateResponse:n});const r=await W().chromeBus.send("fb-api.auth-fcs",{appId:a,stateCode:o,withCrossposting:!0});if(!r)throw ie({code:se});const i=await ue({url:"https://business.facebook.com/media_manager/instagram/oauthlink/update/",body:{code:r}});if(!(null==i||null===(t=i.payload)||void 0===t?void 0:t.adminedPageID))throw ie({code:ae})}),"connect-to-fcs-with-crossposting"),fcsDeletePost:ce((async function(e){await ue({url:G().default("https://business.facebook.com/media/manager/instagram_media/delete/",{id:e})})}),"fcs-delete-post"),fcsSaveAsDraft:ce((async function(e){await ue({url:G().default("https://business.facebook.com/media/manager/instagram_media/edit/save/",{"edit_data[media_id]":e,"edit_data[save_as_draft]":!0,"edit_data[source_product_name]":"MEDIA_MANAGER"})})}),"fcs-save-as-draft"),fcsSaveAsScheduled:ce((async function(e,t){await ue({url:G().default("https://business.facebook.com/media/manager/instagram_media/edit/save/",{"edit_data[media_id]":e,"edit_data[save_as_scheduled]":!0,"edit_data[scheduled_publish_time]":Math.round(t/1e3),"edit_data[source_product_name]":"MEDIA_MANAGER"})})}),"fcs-save-as-scheduled")};const re=Symbol("isFbApiError");function ie(e={}){return{...e,[re]:!0}}async function le(e,{withCrossposting:t=!1}={}){let s;const a=e.split('<link rel="preload" href="').map((e=>e.split('"')[0])).filter((e=>e.includes(".js")));for(const e of a){const a=await K().fetcher.fetchText(e,{credentials:"omit"}),n=t?a.match(/authenticateUser.*app_id:(\d+),response_type:"code"/):a.match(/app_id:(\d+),response_type:"code"/);if(s=null==n?void 0:n[1],s)break}return s||(z().sentryController.sendError("fbApi.connectToFcs: failed to fetch app id for fcs connection","error",{},{actor:"fb-api"}),s=t?"2216244465360995":"532380490911317"),s}async function ue({url:e,incognito:t=!1,body:s={}}){var a;K().fetcher.ignoreCache();const n=(null===(a=(await K().fetcher.fetchText("https://business.facebook.com/creatorstudio")).match(/"DTSGInitialData"[^"]*"token":"([^"]*)"/))||void 0===a?void 0:a[1])||null,o=(await K().fetcher.fetchText(e,{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:V().default({__a:1,locale:"en_US",...n&&{fb_dtsg:n},...s})})).replace("for (;;);","")||"{}",r=JSON.parse(J().default(o)),i=r.payload||{};if(Array.isArray(i.error)&&i.error.length||Z(i.error)&&Object.keys(i.error).length||i.error_code||i.errorCode||i.errorMessage)throw ie({code:X,payload:i});return r}function ce(e,t){const s=async(...s)=>{try{return await e(...s)}catch(e){if(e&&e[re])throw e.method=t,e;throw z().sentryController.sendError("fb-api."+t,"error",{details:e},{actor:"fb-api"}),ie({code:ne,method:t,details:e})}};return W().chromeBus.on("fb-api."+t,(async(...e)=>{let t,a;try{t=await s(...e)}catch(e){a=e}return{result:t,error:a}})),s}const de={init({parent:e}){this.parent=e,j().model.observe((e=>e.authStatus?e.authStatus.username:null),(()=>{this.updatePromocode()}),!1)},async updatePro(){await new Promise((e=>this.updatePromocode(e)))},updatePromocode(e){log("billing: updating promocode...");const{username:t,userId:s}=j().model.state.authStatus;if(t){const a={username:t,userId:s};if(H().env.options.collectBillingStats){const{followersCount:e,followingsCount:t,postsCount:n}=j().model.state.userDetails[s]||{};"number"==typeof e&&(a.followers=e),"number"==typeof t&&(a.followings=t),"number"==typeof n&&(a.posts=n)}this.parent.apiSender.send("/promo",{query:a}).then((t=>{if(!t||"ok"!==t.status)throw t;log("  received promocode: "+JSON.stringify(t));const s=t&&t.expiresAt;j().model.state.billing.promocode!==s&&j().transaction((e=>{e.billing.promocode=s})),this.parent.reply(e,s)})).catch((t=>{log("  retrieving promocode failed: "+JSON.stringify(t)),this.parent.reply(e,j().model.state.billing.promocode)}))}else log("  no username to retrieve promocode for"),this.parent.reply(e,j().model.state.billing.promocode);return!!e}},fe={init({parent:e}){this.parent=e,j().model.observe((e=>e.billing.trial),(e=>{this.updateCookie(e)}),!1)},async updatePro(){await new Promise((e=>this.updateTrial(e)))},async updateTrial(e){log("billing: updating trial period...");const t=j().model.state.billing.trial,s=await this._getCookie({name:"tsd"});if(this._isCookieEmpty(s))return void this.parent.reply(e,t);const a=this._mergeTrialValues(t,s);a.installedOn||(a.installedOn=Date.now()),M().default.isEqual(t,a)||j().transaction((e=>{e.billing.trial=a})),M().default.isEqual(s,a)||this._setCookie({name:"tsd",value:a}),this.parent.reply(e,a)},async updateCookie(e){const t=await this._getCookie({name:"tsd"});this._isCookieEmpty(t)||(e=this._mergeTrialValues(t,e)),M().default.isEqual(t,e)||this._setCookie({name:"tsd",value:e})},_isCookieEmpty:e=>!e||1===Object.keys(e).length,_mergeTrialValues(e,t){const s={...e,...t};s.installedOn>e.installedOn&&(s.installedOn=e.installedOn);for(const t in s)(e[t]||0)>(s[t]||0)&&(s[t]=e[t]||0);return s},_getCookie:async({name:e})=>new Promise((t=>{chrome.cookies.getAll({url:"https://"+H().env.options.domain},(s=>{let a=(s||[]).filter((t=>t.name===e))[0]||{value:""};a=a.value;try{a=atob(a)}catch(e){}try{a=JSON.parse(a)}catch(e){a=null}t(a)}))})),async _setCookie({name:e,value:t}){const s=Math.round(Date.now()/1e3),a=s+31536e4>2147483647?s+31536e4:2147483647;return new Promise((s=>{chrome.cookies.set({name:e||"cookie",value:btoa(JSON.stringify(t)),url:"https://"+H().env.options.domain,path:"/",httpOnly:!1,secure:!1,storeId:"0",domain:H().env.options.domain,sameSite:"strict",expirationDate:a},s)}))}},ge={init({parent:e}){this.parent=e,chrome.runtime.onMessage.addListener(((e,t,s)=>"fspring.subscription-success"===e.name?this.onFSpringSubscriptionSuccess(e,s):"fspring.subscription-failure"===e.name?this.onFSpringSubscriptionFailure(e,s):void 0)),chrome.runtime.onMessage.addListener(((e,t,s)=>"update-fspring-status"===e.name&&this.updateFSpringStatus(s))),j().model.observe((e=>e.authStatus?e.authStatus.username:null),(()=>{this.recordUsernames()}),!0),j().model.observe((e=>e.billing&&e.billing.account?e.billing.account.token:null),(()=>{this.recordUsernames()}),!1),j().model.observe((e=>e.billing&&e.billing.account?e.billing.account.token:null),(()=>{this.updateFSpringStatus()}),!1)},recordUsernames(){const{billing:e,authStatus:t}=j().model.state,s=t.username;if(!s)return;const a=e.account?e.account.token:null;if(!a)return;if(-1!==e.recordedUsernames.indexOf(s))return;log("billing: updating associated fspring account usernames...");const n={usernames:[s]};this.parent.apiSender.send("/auth/record-usernames",{body:n,token:a}).then((()=>{j().transaction((e=>{e.billing.recordedUsernames=[...e.billing.recordedUsernames,s]}))})).catch((()=>{}))},async updatePro(){return new Promise((e=>this.updateFSpringStatus(e)))},updateFSpringStatus(e){log("billing: updating fspring status...");const{billing:t}=j().model.state,s=t.account?t.account.token:null;if(s){const t="/fspring/data";this.parent.apiSender.send(t,{token:s}).then((t=>{if(!t||"ok"!==t.status)throw t;j().transaction((e=>{e.billing.subscriptions=t.subscriptions||{},e.billing.products=t.products||{},e.billing.orders=t.orders||[]})),this.parent.reply(e,j().model.state.billing)})).catch((s=>{"TypeError"===s.name&&"Failed to fetch"===s.message||("forbidden"===s.status||"unauthorized"===s.status||"account-not-found"===s.status||"account-is-not-active"===s.status?j().transaction((e=>{e.billing.account.email=null,e.billing.account.token=null})):z().sentryController.sendError("Unexpected API error at "+t,"error",{error:s},{actor:"auth"})),this.parent.reply(e,j().model.state.billing)}))}else j().transaction((e=>{e.billing.optimistic=null,e.billing.subscriptions={},e.billing.products={},e.billing.orders=[]})),this.parent.reply(e,j().model.state.billing);return!!e},onFSpringSubscriptionSuccess(e,t){log("billing: handling fspring subscription success..."),j().transaction((e=>{e.billing.optimistic={on:Date.now(),plan:e.billing.purchasingPlan.id},e.billing.purchasingPlan=null}));const s=JSON.stringify({subscriptions:j().model.state.billing.subscriptions,products:j().model.state.billing.products,orders:j().model.state.billing.orders}),a=Date.now();let n=3e3;const o=()=>{log("billing: polling server for status update..."),j().model.state.billing.optimistic&&this.updateFSpringStatus((e=>{const t=Date.now();t-a>36e5?j().transaction((e=>{e.billing.optimistic=null})):(e=JSON.stringify({subscriptions:e.subscriptions,products:e.products,orders:e.orders}),s===e?(n=t-a>3e4?6e5:3e3,setTimeout(o,n)):j().transaction((e=>{e.billing.optimistic=null})))}))};return setTimeout(o,n),!!t},onFSpringSubscriptionFailure:(e,t)=>(log("billing: handling fspring subscription failure..."),j().transaction((e=>{e.billing.purchasingPlan=null})),!!t)},he={init(){this.apiSender=new(L().Sender)({urlPrefix:H().env.options.apiUrl}),de.init({parent:this}),fe.init({parent:this}),ge.init({parent:this});return chrome.alarms.create("update-pro",{delayInMinutes:1440,periodInMinutes:1440}),chrome.alarms.onAlarm.addListener((e=>{"update-pro"===e.name&&this.updatePro()})),chrome.runtime.onMessage.addListener(((e,t,s)=>"update-pro"===e.name&&this.updatePro())),this},async updatePro(){await Promise.all([de.updatePro(),fe.updatePro(),ge.updatePro()])},reply(e,t){if(e)try{e(t)}catch(e){}}};B().default;var pe={init:function(){W().chromeBus.on("cleanup.clean-up-state",(()=>{const e=Date.now();return me(e),e}))},cleanUpState:me};function me(e){j().transaction((t=>{t.cleanupId=e,t.dm.badgeText="",t.dm.ghostModeFailed=!1,t.reels.supported=!1,t.reels.creating=!1,t.igView.creationCardShown=!1,t.igView.fullscreenWidth=460,t.billing.purchasingPlan=null,t.tagAssist.shown=!1,t.tagAssist.query="",t.tagAssist.searching=!1,t.tagAssist.errorCode=null,t.tagAssist.selectedTabId="search",t.tagAssist.selectedGroupId="medium",t.tagAssist.selectedTags=[],t.tagAssist.preselectedTags=[],t.tagAssist.preselectedText="",t.tagAssist.ladderEngagementSort=null,t.tagAssist.summaryEngagementSort="descending",t.tagAssist.ladderPostCountSort=null,t.tagAssist.summaryPostCountSort=null,t.tagAssist.ladder=null,t.tagAssist.ladderLoadingTags=[],t.tagAssist.newCollection.name="",t.tagAssist.newCollection.text="",t.tagAssist.newCollection.showForm=!1,t.tagAssist.collectionsLoadingTags=[];for(const e of t.tagAssist.collections)e.editing=!1,e.editName="",e.editText="";Object.assign(t.coverAssist,B().default),t.insights.filters.query="",t.insights.filters.posts="all",t.insights.filters.accounts="all",t.insights.loading=!1,t.analytics.filters.query="",t.analytics.filters.accounts="all",t.analytics.loading=!1,t.schedule.loading=!0,t.schedule.fcsError=null,t.schedule.fcsFailed=!1,t.schedule.isErrorShown=!1,t.schedule.isUpsellShown=!1,t.schedule.hasUncommitedChanges=!1,t.schedule.gridAddCardAttention=!1,t.schedule.tasks=[],t.schedule.bulkUploadErrors=[],t.schedule.posts=t.schedule.posts.filter((e=>"saving"!==e.saveStatus)).filter((e=>"deleting"!==e.saveStatus)),t.schedule.posts.forEach((e=>{e.preview=null})),t.schedule.fallback.isFailedToReconnect=!1,t.schedule.fallback.isRetryingFbConnection=!1,t.schedule.fallback.hideSwitchToFallbackButton=!1,t.schedule.navigation.isOpen=!1,t.schedule.navigation.selectedTabId=null,t.schedule.navigation.withBackToCalendarButton=!1,t.schedule.fcsSetup.checking=!0,t.schedule.fcsSetup.connected=!1,t.schedule.fcsSetup.connecting=!1,t.schedule.fcsSetup.showPanel=!1,t.schedule.fcsSetup.errorCode=null,t.schedule.calendar.periodStart=null,t.schedule.dateDialog=E().default(t)}))}var we={init:async function(){return void await _().idbController.delete("image-proxy.cache");ye=await _().idbController.get("image-proxy.cache")||{},be.resolve(),W().chromeBus.on("image-proxy.save",Se),W().chromeBus.on("image-proxy.cache-item-used",ke)},save:Se};const ve=15*N().SECOND,be=function(){let e;const t=new Promise((t=>{e=t}));return Object.defineProperty(t,"resolve",{get:()=>e}),t}();let ye;async function Se(e){}async function ke(e){ye[e]&&(ye[e].lastUsedAt=Date.now(),Ie())}function Ie(){const e=Ie;clearTimeout(e.timeout),e.timeout=setTimeout((async()=>{_().idbController.set("image-proxy.cache",ye)}),ve)}var Te={getVersion:function(){if(void 0===Pe){const e=/Chrome\/([0-9.]+)/.exec(window.navigator.userAgent)[1];Pe=e?Number(e.split(".")[0]):-1}return Pe}};let Pe;var Ce={init:function(){Re=-1,W().chromeBus.on("core-web-request.popup-tab-id",(e=>{Ae=e}))},watch:function(e,t){chrome.webRequest.onBeforeRequest.addListener((e=>{let s=null;const a=new URL(e.url).host;return t({details:e,isBeforeRequest:!0,isRequest:!1,isResponse:!1,fromExtension:xe(e),checkUrl:t=>e.url.includes(t),checkHost:e=>a.includes(e),redirect(e){s={redirectUrl:e}},getHeader(){},setHeader(){}}),s}),{urls:e},["blocking"]),chrome.webRequest.onBeforeSendHeaders.addListener((e=>{Ue(e.requestHeaders);const s=new URL(e.url).host;return t({details:e,isBeforeRequest:!1,isRequest:!0,isResponse:!1,fromExtension:xe(e),redirect(){},checkUrl:t=>e.url.includes(t),checkHost:e=>s.includes(e),getHeader:t=>(t=t.toLowerCase(),e.requestHeaders.find((e=>e.name===t))),setHeader(t,s){t=t.toLowerCase(),e.requestHeaders=e.requestHeaders.filter((e=>e.name!==t)),e.requestHeaders.push({name:t,value:s})}}),{requestHeaders:e.requestHeaders}}),{urls:e},Te.getVersion()<72?["blocking","requestHeaders"]:["blocking","requestHeaders","extraHeaders"]),chrome.webRequest.onHeadersReceived.addListener((e=>{Ue(e.responseHeaders);const s=new URL(e.url).host;return t({details:e,isBeforeRequest:!1,isRequest:!1,isResponse:!0,fromExtension:xe(e),redirect(){},checkUrl:t=>e.url.includes(t),checkHost:e=>s.includes(e),getHeader:t=>(t=t.toLowerCase(),e.responseHeaders.find((e=>e.name===t))),setHeader(t,s){t=t.toLowerCase(),e.responseHeaders=e.responseHeaders.filter((e=>e.name!==t)),e.responseHeaders.push({name:t,value:s})}}),{responseHeaders:e.responseHeaders}}),{urls:e},Te.getVersion()<72?["blocking","responseHeaders"]:["blocking","responseHeaders","extraHeaders"])}};let Ae=null,Re=null;function Ue(e){for(const t of e)t.name=t.name.toLowerCase()}function xe(e){return e.tabId===Ae||e.tabId===Re}const Fe=D().default();var Oe={init:function(){Ce.watch(["https://*.onfastspring.com/*","https://*.instagram.com/*","https://*.facebook.com/*","https://*.inssist.com/*"],De)},onRequest:Fe};let qe;function De({details:e,isBeforeRequest:t,isRequest:s,isResponse:a,fromExtension:n,redirect:o,getHeader:r,setHeader:i,checkUrl:l,checkHost:u}){var c,d,f;if(Fe(arguments[0]),t&&u("app.inssist.com")&&o(chrome.runtime.getURL("/inssist.html")),t&&u("instagram.com")&&l("service-worker-")&&o(chrome.runtime.getURL("/js/ig-service-worker.js")),s&&n&&(u("instagram.com")||u("facebook.com")||u("fastspring.com"))){const t=r("origin");if(null==t?void 0:t.value.startsWith("chrome-extension")){i("origin",new URL(e.url).origin)}}s&&u("instagram.com")&&l("/direct/inbox")&&(null===(c=e.initiator)||void 0===c?void 0:c.startsWith("chrome-extension://"+chrome.runtime.id))&&(qe=e.frameId);const g=s&&u("instagram.com")&&"POST"===e.method&&(l("/accounts/login/ajax/")||l("/one_tap_web_login/")),h=s&&u("instagram.com")&&(n||l("/api/v1/"))&&!l("/tv/upload")&&e.tabId!==qe;if(g||h){let e="Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1";l("/api/v1/")&&(e+=" Instagram 72.0.0.21.98"),i("user-agent",e)}a&&(u("instagram.com")||u("facebook.com")||u("inssist.com")||u("onfastspring.com"))&&(e.responseHeaders=e.responseHeaders.filter((e=>"x-frame-options"!==e.name))),a&&(u("instagram.com")||u("facebook.com")||u("inssist.com")||u("onfastspring.com"))&&(e.responseHeaders=e.responseHeaders.filter((e=>"content-security-policy"!==e.name))),a&&u("facebook.com")&&(l("/confirmemail.php")||l("/home.php"))&&(null===(d=e.initiator)||void 0===d?void 0:d.includes("business.facebook.com"))&&(i("access-control-allow-origin","https://business.facebook.com"),i("access-control-allow-credentials","true")),a&&u("facebook.com")&&l("/home.php")&&(null===(f=e.initiator)||void 0===f?void 0:f.includes("web.facebook.com"))&&(i("access-control-allow-origin","https://web.facebook.com"),i("access-control-allow-credentials","true")),a&&u("instagram.com")&&i("access-control-expose-headers","*, Authorization")}var _e={init:async function(){await async function(){if("username"in j().model.state.authStatus)return;K().fetcher.ignoreCache();const e=await F().igApi.fetchViewerInfo();if(e.error)return;const t=e.result||null;j().transaction((e=>{e.authStatus.userId=(null==t?void 0:t.userId)||null,e.authStatus.username=(null==t?void 0:t.username)||null,e.authStatus.fullName=(null==t?void 0:t.fullName)||null,e.authStatus.email=(null==t?void 0:t.email)||null,e.authStatus.avatarUrl=(null==t?void 0:t.avatarUrl)||null,e.authStatus.isLoggedIn=!!t,e.authStatus.isMobileSession=(null==t?void 0:t.isMobileSession)||!1,e.authStatus.cookies=(null==t?void 0:t.cookies)||{igSessionId:null,fb:[]}})),await We()}(),function(){let e;chrome.cookies.onChanged.addListener((({cookie:t,removed:s})=>{Ee||j().model.state.schedule.fcsSetup.connecting||".instagram.com"===t.domain&&"sessionid"===t.name&&(clearTimeout(e),e=setTimeout((()=>{Le({isSettingSessionId:!s})})))}))}(),function(){let e;Oe.onRequest((({details:s,isResponse:a,checkHost:n})=>{if(a&&n("facebook.com")){!!s.responseHeaders.find((e=>"set-cookie"===e.name))&&(clearTimeout(e),e=setTimeout(t))}}));const t=async()=>{const e=await R().default(chrome.cookies.getAll,{domain:".facebook.com"});j().transaction((t=>{t.authStatus.cookies.fb=e}))}}(),W().chromeBus.on("auth.set-ig-initial-url",Me),W().chromeBus.on("auth.login",He),W().chromeBus.on("auth.logout",je),W().chromeBus.on("auth.refresh-user",Le),W().chromeBus.on("auth.toggle-session-watcher",Ge),chrome.runtime.onMessage.addListener(((e,t,s)=>"update-user"===e.name&&Be()))},updateUser:Be,refreshUser:Le,clearFbCookies:Je};let Ne=null,Ee=!1;async function Be(e=!1){log("auth-controller: updating user id...");!await Le()&&e&&chrome.tabs.update({url:q().ig.login.url})}async function Le({isSettingSessionId:e=!1}={}){const t=Le,s=O().generate();t.requestId=s,K().fetcher.ignoreCache();const a=await F().igApi.fetchViewerInfo();if(t.requestId!==s)return;if(a.error)return;const n=a.result||null,o=n&&j().model.state.authStatus.userId===n.userId;return n&&we.save(n.avatarUrl),j().transaction((t=>{if(n&&t.authStatus.userId===n.userId)return t.authStatus.username=n.username,t.authStatus.avatarUrl=n.avatarUrl,t.multiaccount.selectedUserId=n.userId,void(e&&(t.authStatus.isMobileSession=!0));if(n){const e=t.multiaccount.userIds;t.multiaccount.addingNewAccount?t.multiaccount.addingNewAccount=!1:t.authStatus.isLoggedIn||x().default(e,t.multiaccount.selectedUserId),e.includes(n.userId)||e.push(n.userId),t.multiaccount.selectedUserId=n.userId}if(t.authStatus.userId){t.userStates[t.authStatus.userId]={};const e=U().getTemplateUserState();for(const s in e)t.userStates[t.authStatus.userId][s]=t[s];t.userStates[t.authStatus.userId].authStatus.isMobileSession=!1}let s=null;n&&t.userStates[n.userId]?(s=t.userStates[n.userId],delete t.userStates[n.userId]):s=U().getTemplateUserState(),s.authStatus.userId=(null==n?void 0:n.userId)||null,s.authStatus.username=(null==n?void 0:n.username)||null,s.authStatus.avatarUrl=(null==n?void 0:n.avatarUrl)||null,s.authStatus.isLoggedIn=!!n,e&&(s.authStatus.isMobileSession=!0),Object.assign(t,s)})),await We(),o||(W().chromeBus.send("iframe-bus","ig.clear-and-show-spinner"),n?Ne?W().chromeBus.send("iframe-bus","ig.hard-go",Ne):(pe.cleanUpState(),W().chromeBus.send("iframe-bus","ig.refresh")):W().chromeBus.send("iframe-bus","ig.hard-go","/accounts/login/"),W().chromeBus.send("iframe-bus","dm.refresh"),W().chromeBus.send("iframe-bus","schedule.fcs-refresh-page")),Ne=null,W().chromeBus.send("auth.refreshed"),n}function Me(e){Ne=e}async function He(e){var t;const s=null===(t=j().model.state.userStates[e])||void 0===t?void 0:t.authStatus;if(s){Ge(!1);try{await Je();for(const e of s.cookies.fb)await R().default(chrome.cookies.set,{url:"https://*.facebook.com",name:e.name,value:e.value,domain:e.domain,path:e.path,secure:e.secure,httpOnly:e.httpOnly,sameSite:e.sameSite,storeId:e.storeId,expirationDate:e.expirationDate});await Ve(),await R().default(chrome.cookies.set,{url:"https://*.instagram.com",name:"sessionid",value:s.cookies.igSessionId,domain:".instagram.com",path:"/",secure:!0,httpOnly:!1,sameSite:"no_restriction",expirationDate:Math.round((Date.now()+365*N().DAY)/1e3)})}catch(e){console.error(e)}Ge(!0),setTimeout((()=>{Le({isSettingSessionId:!1})}))}else console.error("auth status not found",{userId:e})}async function je(){await Je(),await Ve()}async function Je(){const e=await R().default(chrome.cookies.getAll,{domain:".facebook.com"});for(const t of e)await R().default(chrome.cookies.remove,{url:"https://*.facebook.com",name:t.name})}async function Ve(){await R().default(chrome.cookies.remove,{url:"https://*.instagram.com/*",name:"sessionid"})}function Ge(e){Ee=!e}async function We(){const e=await R().default(chrome.cookies.get,{url:"https://*.instagram.com",name:"sessionid"}),t=await R().default(chrome.cookies.getAll,{domain:".facebook.com"});j().transaction((s=>{s.authStatus.cookies.igSessionId=(null==e?void 0:e.value)||null,s.authStatus.cookies.fb=t}))}var ze={init:function(){W().chromeBus.on("schedule.connect-to-fcs",Ke),W().chromeBus.on("schedule.connect-to-fcs-with-crossposting",$e)}};async function Ke(){var e;j().transaction((e=>{e.schedule.fcsSetup.connecting=!0})),await _e.clearFbCookies(),K().fetcher.ignoreCache();const t=(null===(e=(await K().fetcher.fetchText("https://business.facebook.com/creatorstudio")).match(/js_datr","([^"]*)"/))||void 0===e?void 0:e[1])||null;await R().default(chrome.cookies.set,{url:"https://*.facebook.com",name:"datr",value:t,domain:".facebook.com",path:"/",secure:!0,httpOnly:!0,sameSite:"no_restriction",storeId:"0",expirationDate:Math.round((Date.now()+365*N().DAY)/1e3)}),K().fetcher.ignoreCache();const s=(await F().igApi.fetchViewerInfo()).result;if(s||j().transaction((e=>{e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.errorCode=A().default.failedToFetchViewerInfo})),s.isProfessionalAccount){try{await oe.connectToFcs()}catch(e){if(j().transaction((e=>{e.schedule.fcsSetup.connecting=!1})),oe.isError(e,se))return void _e.refreshUser();let t;return t=oe.isError(e)?e.code:A().default.unknown,j().transaction((e=>{e.schedule.fcsSetup.errorCode=t})),z().sentryController.sendError("schedule setup: "+t,"error",e,{actor:"schedule"}),void C().gaController.sendEvent("user","schedule:setup-connection-error",t)}j().transaction((e=>{e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.showPanel=!1,e.schedule.loading=!0})),await _e.refreshUser(),W().chromeBus.send("iframe-bus","schedule.fcs-refresh-page"),C().gaController.sendEvent("user","schedule:setup-connection-success")}else j().transaction((e=>{e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.errorCode=A().default.nonProfessionalAccount}))}async function $e(){j().transaction((e=>{e.schedule.fcsSetup.connecting=!0}));const e=await oe.checkAuth();if(e){e&&await oe.logoutFcs();try{await oe.connectToFcsWithCrossposting()}catch(e){if(j().transaction((e=>{e.schedule.navigation.isOpen=!1,e.schedule.fcsSetup.connecting=!1})),oe.isError(e,se))return void _e.refreshUser();let t;return oe.isError(e,ae)?(t=A().default.noConnectedFbPage,W().chromeBus.send("iframe-bus","schedule.fcs-refresh-page")):t=oe.isError(e)?e.code:A().default.unknown,j().transaction((e=>{e.schedule.fcsSetup.showPanel=!0,e.schedule.fcsSetup.errorCode=t})),z().sentryController.sendError("schedule crossposting setup: "+t,"error",e,{actor:"schedule"}),j().transaction((e=>{e.schedule.loading=!0})),P().eventBus.send("schedule.update-ig-posts"),void C().gaController.sendEvent("user","schedule:setup-crossposting-error",t)}j().transaction((e=>{e.schedule.navigation.isOpen=!1,e.schedule.navigation.selectedTabId=null,e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.showPanel=!1,e.schedule.loading=!0})),await _e.refreshUser(),W().chromeBus.send("iframe-bus","schedule.fcs-refresh-page"),C().gaController.sendEvent("user","schedule:setup-crossposting-success")}else j().transaction((e=>{e.schedule.navigation.isOpen=!1,e.schedule.fcsSetup.connecting=!1,e.schedule.fcsSetup.showPanel=!0,e.schedule.fcsSetup.errorCode=A().default.fbLoginRequired}))}var Qe={init:function(){!function(){const e={};let t=!1,s=!1;async function a(){if(t)return void(s=!0);t=!0;const n={};let o=0;for(const t of T().default.getPosts()){const a=j().model.state,r=t.id,i=a.schedule.posts.find((e=>e.id===r));if("fcs"!==i.source)continue;if(e[i.id])continue;if(o+=1,o>9){s=!0;continue}const l="schedule.fcs-post-preview:"+i.id,u=await I().default((()=>_().idbController.get(l)));if(u){e[i.id]=URL.createObjectURL(u);continue}let c;try{const e=await K().fetcher.fetch(i.image,{credentials:"omit"}),t=await e.blob();c=await k().default(t)}catch(e){console.error(e);continue}await I().default((()=>_().idbController.set(l,c.blob))),n[i.id]=c.averageColor,e[i.id]=URL.createObjectURL(c.blob)}j().transaction((t=>{const s=t.schedule.posts.filter((e=>"fcs"===e.source));for(const t of s)t.preview=e[t.id];for(const e in n){const t=s.find((t=>t.id===e));t&&(t.imageAvgColor=n[e])}})),t=!1,s&&(s=!1,a())}j().model.observe((e=>T().default.getPosts().filter((e=>"fcs"===e.source)).map((e=>e.id)).join("-")),a),W().chromeBus.on("popup.start",(()=>{for(const t in e)URL.revokeObjectURL(e[t]),delete e[t];a()}))}()}};var Ye={init:function(){!function(){let e;W().chromeBus.on("schedule.upload-99",(t=>{clearTimeout(e),e=setTimeout((()=>{z().sentryController.sendError("Upload stuck at 99.9%","error",{debugData:t},{actor:"schedule"})}),20*N().SECOND)})),W().chromeBus.on("schedule.upload-100",(()=>{clearTimeout(e)}))}()}};var Ze={init:function(){ze.init(),Qe.init(),Ye.init(),async function(){W().chromeBus.on("popup.start",(async()=>{const e=[j().model.state,...Object.values(j().model.state.userStates)],t=e.map((e=>e.schedule.posts)).flat().filter((e=>"fcs"===e.source)).map((e=>e.id.toString())),s=e.map((e=>e.schedule.posts)).flat().filter((e=>"local"===e.source)).map((e=>e.id.toString())),a=await _().idbController.getAllKeys();for(const e of a)if(e.startsWith("schedule.fcs-post-preview:")){const s=e.split(":")[1];if(t.includes(s))continue;await I().default((()=>_().idbController.delete(e)))}else if(e.startsWith("schedule.local-post:")){const t=e.split(":")[1];if(s.includes(t))continue;await I().default((()=>_().idbController.delete(e)))}}))}(),W().chromeBus.on("schedule.update-ig-posts",Xe),P().eventBus.on("schedule.update-ig-posts",Xe)},getReport:async function(){return await W().chromeBus.send("iframe-bus","schedule.fcs-get-report")}};async function Xe(){const e=j().model.state,t=e.authStatus.username;if(!t)return;if(e.schedule.fcsSetup.checking)return;if(e.schedule.fcsSetup.connected)return;K().fetcher.ignoreCache();const s=await F().igApi.fetchUserPosts(t,50);if(e.authStatus.username!==t)return;const a=(s.result||[]).map((e=>{const t={photo:"photo",video:"video",carousel:"carousel"}[e.type];return t?S().default({id:e.id,source:"ig",type:t,status:"posted",image:e.imgMedium||e.img||e.imgx,preview:e.imgMedium||e.img||e.imgx,imageAvgColor:null,on:e.on,createdOn:e.on,stats:{likes:e.stats.likes,comments:e.stats.comments},crosspostToFb:null,saveStatus:null,draftOrder:null}):null})).filter(Boolean);j().transaction((e=>{e.schedule.loading=!1,e.schedule.lastIgPostsUpdateOn=Date.now(),e.schedule.posts=e.schedule.posts.filter((e=>"local"===e.source)).concat(a)}))}E().default;var et={init:function(){W().chromeBus.on("overseer.send-report",at)},sendReport:at};const tt=["acknowledged","analytics","dm","experiments","followUs","igTask","igView","igtvUpload","insights","multiaccount","rateUs","sidebar","tagAssist","userDetails","welcome",{field:"authStatus",cb:e=>M().default.cloneDeep(e)},{field:"authStatus.cookies",cb:()=>"!sanitized"},{field:"billing",cb:e=>M().default.cloneDeep(e)},{field:"billing.account.token",cb:()=>"!sanitized"},{field:"schedule",cb:e=>{const t=M().default.cloneDeep(e);return t&&t.posts&&(t.posts=t.posts.map((e=>(delete e.image,delete e.preview,e)))),t}},{field:"userStates",cb:()=>"!ignored"},{field:"whatsNew",cb:()=>"!ignored"}],st=new(L().Sender)({urlPrefix:H().env.options.apiUrl});async function at({key:e,filters:t,data:s}={}){if(e=e||"system",s=s||{},(t=t||{}).username||(t.username=U().stateProxy.username()||"unknown"),"string"!=typeof s&&!s.state){const e=j().model.state,t={};tt.forEach((s=>{if("string"==typeof s)t[s]=e[s];else{const a=e[s.field];t[s.field]=s.cb(a)}})),s.state=t}"string"==typeof s||s.schedule||(s.schedule=await Ze.getReport());try{s=JSON.stringify(s)}catch(e){s=e.message}const a={key:e,filters:t,data:s};H().env.is.development&&W().chromeBus.send("popup.log","%coverseer report [background]","color: #c818dc",{key:e,filters:t,data:JSON.parse(s)}),st.send("/overseer",{body:a}).then((t=>{log(`overseer ${e} report of ${s.length} bytes was sent`)})).catch((t=>{error(`! failed sending ${e} overseer report of ${s.length} bytes:`),error(t)}))}const nt=new Y(q().sleepTimes.action);var ot={init:async function(){log("ig-task: initialisation succeeded"),W().chromeBus.on("ig-task.follow-user",it),W().chromeBus.on("ig-task.unfollow-user",lt),W().chromeBus.on("ig-task.like-user",ut),j().model.observe((()=>U().stateProxy.userId()),(()=>nt.cleanup()),!1)},followUser:it,unfollowUser:lt};const rt={};async function it(e){if(!e)return!1;const{userId:t}=e;return nt.addTask((async()=>{const e=await F().igApi.followUser(t);return e.error?(ct(e.error),!1):(j().transaction((e=>{e.igTask.followStatus||(e.igTask.followStatus={}),e.igTask.followStatus[t]=!0})),!0)}))}async function lt(e){if(!e)return!1;const{userId:t}=e;return nt.addTask((async()=>{const e=await F().igApi.unfollowUser(t);return e.error?(ct(e.error),!1):(j().transaction((e=>{e.igTask.followStatus||(e.igTask.followStatus={}),e.igTask.followStatus[t]=!1})),!0)}))}async function ut(e){if(!e)return!1;const{userId:t,username:s}=e,a=U().stateProxy.userId(),n=()=>{j().transaction((e=>{const s=U().stateProxy.userId()===a?e:e.userStates[a];!s||s.igTask.likeStatus[t]<=0||(s.igTask.likeStatus[t]-=1)}))},o=j().model.state.igTask.likeStatus[t]||0;return!(o>=12)&&(j().transaction((e=>{e.igTask.likeStatus[t]=o+1})),nt.addTask((async()=>{let e=await F().igApi.fetchRootUserPostsPage(s);if(e.error)return n(),ct(e.error),!1;e=e.result;const t=e.posts.filter((e=>!e.isLiked&&!0!==rt[e.code]));if(0===t.length)return n(),!1;let a=null;if(e.posts[0]===t[0])a=e.posts[0];else{let e=0,s=null;t.forEach((t=>{const a=t.stats.likes+10*t.stats.comments;a>=e&&(s=t,e=a)})),a=s}return(await F().igApi.likePost(a.id)).error?(n(),ct(e.error),!1):(rt[a.code]=!0,!0)}),(()=>{n()})))}function ct(e){const{code:t}=e;t!==F().ec.noNetwork&&t!==F().ec.timedOut&&t!==F().ec.redirectToLogin&&t!==F().ec.suspended&&t!==F().ec.forbidden&&t!==F().ec.tooManyRequests&&t!==F().ec.serverIsDown&&t!==F().ec.badGateway&&t!==F().ec.serviceUnavailable||nt.cleanup(),j().transaction((e=>{e.igTask.actionBlockCode=t}))}const dt=new Y(q().sleepTimes.peers);var ft={init:async function(){log("analytics: initialisation succeeded"),null!==j().model.state.analytics.runningJobId&&j().transaction((e=>{e.analytics.runningJobId=null}));W().chromeBus.on("analytics.check-now",(()=>pt().catch((e=>{j().transaction((t=>{t.analytics.runningJobId=null,t.analytics.error=e.message||e}))})))),W().chromeBus.on("analytics.stop",(()=>mt().then((()=>{j().transaction((e=>{e.analytics.error="check has been interrupted"}))})))),j().model.observe((e=>U().stateProxy.userId()),(()=>{null!==j().model.state.analytics.runningJobId&&j().transaction((e=>{e.analytics.runningJobId=null})),clearTimeout(gt),gt=null,ht()}),!1),j().model.observe((e=>e.analytics.runAutomatically),(()=>{ht()}),!0)},start:pt,stop:mt};let gt=null;async function ht(){if(!j().model.state.analytics.runAutomatically)return clearTimeout(gt),gt=null,void j().transaction((e=>{e.analytics.nextScanOn=null}));if(gt)return;const e=Date.now(),t=864e5,s=j().model.state.analytics.lastScanOn;let a;a=null===s?e+6e4:s+t>e?s+t:e+6e4,j().transaction((e=>{e.analytics.nextScanOn=a})),gt=setTimeout((()=>{pt().catch((t=>{j().transaction((s=>{s.analytics.lastScanOn=e,s.analytics.runningJobId=null,s.analytics.error=t.message||t}))})).then((()=>{gt=null,ht()}))}),a-e)}async function pt({nosleep:e=!1}={}){if(null!==j().model.state.analytics.runningJobId)return;if(!j().model.state.authStatus.isLoggedIn)return;const t=O().generate();j().transaction((e=>{e.analytics.runningJobId=t,e.analytics.scanProgress=0}));const s=await y().default.getAnalytics(),a=Date.now(),n=U().stateProxy.username(),o=await async function(e){K().fetcher.ignoreCache();const t=await F().igApi.fetchUserDetails(e);if(!t.result){if(t.error.code===F().ec.tooManyRequests)return null;throw new Error(`could not fetch @${e} followers count`)}return t.result}(n),r=async(r,i=0)=>{let l,u,c,d,f;if("followers"===r)l=s.followers,u=o.followersCount,c=q().analytics.maxFollowersCount,d=F().igApi.fetchRootFollowersPage,f=F().igApi.fetchNextFollowersPage;else{if("followings"!==r)return console.error("invalid peers type"),null;l=s.followings,u=o.followingsCount,c=q().analytics.maxFollowingsCount,d=F().igApi.fetchRootFollowingsPage,f=F().igApi.fetchNextFollowingsPage}const g=new Set(l.map((e=>e.userId)));let h,p=!1,m=0;h=0===l.length?null:o?u-l.length:null;let w=[];const v=new Set,b=[],y=[];let S=null;const k=e=>dt.addTask((()=>(K().fetcher.ignoreCache(),e?f(e):d(n))));do{if(S&&!e&&(await $().default(q().sleepTimes.peers),wt()!==t))return null;let s=await k(S);if(s.result||(s=await k(S)),wt()!==t)return null;if(!s.result)throw new Error(`could not fetch @${n} ${r}`);S=s.result,w.push(...S.users);for(const e of S.users)we.save(e.avatarUrl);if(w.length>c&&(w=w.slice(0,c)),o&&j().transaction((e=>{const t=Math.min(o.followersCount,q().analytics.maxFollowersCount),s=Math.min(o.followingsCount,q().analytics.maxFollowingsCount),a=(i+w.length)/(t+s)*100;e.analytics.scanProgress=Math.max(0,Math.min(a,100))})),0===l.length)continue;if(p=!0,S.users.forEach((e=>{v.add(e.userId),g.has(e.userId)||(b.push({...e,on:a}),p=!1)})),p)for(;m<l.length&&m<w.length-b.length;){const e=l[m];v.has(e.userId)||y.push({...e,on:a}),m++}const u=b.length-y.length===h;if(p&&u)break}while(S.hasNextPage&&w.length<c);if(!S.hasNextPage)for(;m<l.length;){const e=l[m];v.has(e.userId)||y.push({...e,on:a}),m++}return{peerList:w,peerIds:v,nPeers:b,uPeers:y}},i=await r("followers");if(!i)return;const l=i.peerList,u=i.peerIds;let c=i.nPeers,d=i.uPeers;const f=await r("followings",l.length);if(!f)return;const g=f.peerList,h=f.peerIds;let p,m,w=f.nPeers,v=f.uPeers;if(0===s.followers.length&&0===s.followings.length)p=l.map((e=>({...e,on:a}))),m=g.map((e=>({...e,on:a}))),await y().default.setAnalytics({followers:p,followings:m});else{d=d.filter((e=>!u.has(e.userId))),v=v.filter((e=>!h.has(e.userId)));const e=new Set(c.map((e=>e.userId))),t=new Set(d.map((e=>e.userId))),n=new Set(w.map((e=>e.userId))),o=new Set(v.map((e=>e.userId)));p=[...l.map((e=>({...e,on:a}))),...s.followers.filter((e=>!u.has(e.userId)&&!t.has(e.userId)))],m=[...g.map((e=>({...e,on:a}))),...s.followings.filter((e=>!h.has(e.userId)&&!o.has(e.userId)))],c=[...c,...s.nFollowers.filter((t=>!e.has(t.userId)))],s.nFollowers.forEach((t=>e.add(t.userId))),w=[...w,...s.nFollowings.filter((e=>!n.has(e.userId)))],s.nFollowings.forEach((e=>n.add(e.userId))),d=[...d,...s.uFollowers.filter((e=>!t.has(e.userId)))].filter((t=>{const s=t.userId;if(!e.has(s))return!0;return c.find((e=>e.userId===s)).on<t.on})),v=[...v,...s.uFollowings.filter((e=>!o.has(e.userId)))].filter((e=>{const t=e.userId;if(!n.has(t))return!0;return w.find((e=>e.userId===t)).on<e.on})),await y().default.setAnalytics({followers:p,followings:m,nFollowers:c,uFollowers:d,nFollowings:w,uFollowings:v})}log(`analytics job ${t} finished, result:`),log("  total followers detected: "+p.length),log("  total followings detected: "+m.length),log("  total new-followers: "+c.length),log("  total un-followers: "+d.length),log("  total new-followings: "+w.length),log("  total un-followings: "+v.length),j().transaction((e=>{const t=Date.now();e.analytics.firstScanOn=e.analytics.firstScanOn||t,e.analytics.lastScanOn=t,e.analytics.runningJobId=null,e.analytics.error=null,e.igTask.followStatus={}}))}async function mt(){j().transaction((e=>{e.analytics.runningJobId=null}))}function wt(){return j().model.state.analytics.runningJobId}var vt={getTaskKey:function(e){return"insights.task-results-"+e},extractTaskIdFromKey:function(e){const t=e.match(/^insights\.task-results-([^.]*)$/);return t&&t[1]||null}};var bt={maxAttempts:4,getAttemptSleepTime:e=>0===e?3*N().SECOND:10*N().SECOND},yt={canRun:function(e){const t=St(e);if(t.lastPage&&!t.lastPage.hasNextPage)return!1;if(t.postsCount>=t.maxPostsCount)return!1;return!0},step:async function e(t,s=0){const a=St(t);let n;try{n=await async function(e){const t=St(e),s=Date.now();let a;if(t.lastPage){const e=new(F().IgPostsPage)(t.lastPage);a=await t.fetchNextPage(e)}else a=await t.fetchRootPage(t.username);if(a.error)throw a.error;return e.responseTimePosts=Date.now()-s,a.result}(t)}catch(a){if(s<bt.maxAttempts-1)return await $().default(bt.getAttemptSleepTime(s)),void await e(t,s+1);throw a}for(const e of n.posts){const t=e.img||e.imgx;we.save(t)}a.results.lastPage=n,a.results.list.push(...n.posts),a.results.list.splice(a.maxPostsCount)}};function St(e){return{username:e.task.user.username,results:e.results.basePosts,lastPage:e.results.basePosts.lastPage,postsCount:e.results.basePosts.list.length,maxPostsCount:q().insights.maxPostsCount,fetchNextPage:F().igApi.fetchNextUserPostsPage,fetchRootPage:F().igApi.fetchRootUserPostsPage}}var kt={canRun:function(e,t){const s=It(e,t);if(s.lastPage&&!s.lastPage.hasNextPage)return!1;if(s.usersCount===s.maxUsersCount)return!1;return!0},step:async function e(t,s,a=0){const n=It(t,s);let o;try{o=await async function(e,t){const s=It(e,t),a=Date.now();let n;if(s.lastPage){const e=new(F().IgUsersPage)(s.lastPage);n=await s.fetchNextPage(e)}else n=await s.fetchRootPage(s.username);if(n.error)throw n.error;return e.responseTimePeers=Date.now()-a,n.result}(t,s)}catch(n){if(a<bt.maxAttempts-1)return await $().default(bt.getAttemptSleepTime(a)),void await e(t,s,a+1);throw n}const r=o.users.map((e=>e.avatarUrl));for(const e of r)we.save(e);n.results.lastPage=o,n.results.list.push(...o.users),n.results.list.splice(n.maxUsersCount)}};function It(e,t){return{followers:{results:e.results.baseFollowers,lastPage:e.results.baseFollowers.lastPage,username:e.task.user.username,usersCount:e.results.baseFollowers.list.length,maxUsersCount:e.task.followersCount,fetchNextPage:F().igApi.fetchNextFollowersPage,fetchRootPage:F().igApi.fetchRootFollowersPage},followings:{results:e.results.baseFollowings,lastPage:e.results.baseFollowings.lastPage,username:e.task.user.username,usersCount:e.results.baseFollowings.list.length,maxUsersCount:e.task.followingsCount,fetchNextPage:F().igApi.fetchNextFollowingsPage,fetchRootPage:F().igApi.fetchRootFollowingsPage}}[t]}var Tt={canRun:e=>kt.canRun(e,"followers"),step:e=>kt.step(e,"followers")},Pt={canRun:e=>kt.canRun(e,"followings"),step:e=>kt.step(e,"followings")},Ct={canRun:function(e,t){return Ut(e,t,!0).length>0},step:async function e(t,s,a=0){const n=xt(t,s),o=Ut(t,s),r=await At({ctx:t,data:n,type:s,index:o[0]});if(r.error){if(r.error.code!==F().ec.redirectToLogin){if(a<bt.maxAttempts-1)return await $().default(bt.getAttemptSleepTime(a)),void await e(t,s,a+1);throw r.error}b().default.banSpamAnalysis.dispatch()}r.user&&n.results.list.push(r.user);if(1===o.length||"ok"!==j().model.state.insights.spamcheck.type){const e=n.results.list.map((e=>v().botOrNot.getCredibility(e,t.userId,{forcePrivate:!0}))).filter((e=>e<q().insights.spamCredibility)).length,s=n.results.list.length;n.results.percent=Math.round(e/s*100)/100}}};async function At({ctx:e,data:t,type:s,index:a,tries:n=0}){const o=At;o.initialized||(o.initialized=!0,o.incognito=!0),t.results.usedIndexes.push(a);const r=Date.now(),i=t.baseUsers[a].username,l=await F().igApi.fetchUserDetails(i,{incognito:o.incognito});if(l.error&&o.incognito){o.incognito=!1;const r="insights."+O().generate();return chrome.alarms.create(r,{delayInMinutes:1440}),chrome.alarms.onAlarm.addListener((e=>{e.name===r&&(o.incognito=!0)})),K().fetcher.ignoreCache(),At({ctx:e,data:t,type:s,index:a,tries:n})}const u=l.result||null;if(b().default.incrementSpamRequestsCount.dispatch(1),e.responseTimeUser=Date.now()-r,u)return{user:u};if(l.error&&n>5||l.error.code===F().ec.redirectToLogin)return{error:l.error};if(l.error&&n>=1){const o=function(e,t,s){if(-1===t)return-1;const a=xt(e,s),n=a.results.indexes,o=a.results.usedIndexes;let r=t;for(;;){if(r+=1,r===a.baseTotal&&(r=0),r===t){r=-1;break}if(!n.includes(r)&&!o.includes(r))break}return r}(e,a,s);return-1===o?{user:null}:At({ctx:e,data:t,type:s,index:o,tries:n+1})}return At({ctx:e,data:t,type:s,index:a,tries:n+1})}function Rt(e,t){const s=xt(e,t);return 0===s.results.indexes.length&&(s.results.indexes=function(e,t){if(0===e)return[];const s=[],a=t/e,n=Array.from(new Array(t)).map(((e,t)=>t));let o=0;for(const e of n)o>e||(o+=a,s.push(e));return s}(s.spamTotal,s.baseTotal)),s.results.indexes}function Ut(e,t,s=!1){const a=xt(e,t);return Rt(e,t).filter((e=>!a.results.usedIndexes.includes(e))).filter((e=>e<(s?a.baseProcessed:a.baseTotal)))}function xt(e,t){return{followers:{results:e.results.spamFollowers,baseUsers:e.results.baseFollowers.list,baseProcessed:e.results.baseFollowers.list.length,baseTotal:e.task.followersCount,spamProcessed:e.results.spamFollowers.list.length,spamTotal:e.task.spamFollowersCount},followings:{results:e.results.spamFollowings,baseUsers:e.results.baseFollowings.list,baseProcessed:e.results.baseFollowings.list.length,baseTotal:e.task.followingsCount,spamProcessed:e.results.spamFollowings.list.length,spamTotal:e.task.spamFollowingsCount}}[t]}var Ft={canRun:e=>Ct.canRun(e,"followers"),step:e=>Ct.step(e,"followers")},Ot={canRun:e=>Ct.canRun(e,"followings"),step:e=>Ct.step(e,"followings")},qt={init:function(){const e=j().model.state.insights;Object.assign(_t,{netStats:{...e.netStats}}),j().model.observe((e=>{const t=JSON.stringify(e.insights.spamcheck);return`${e.insights.tasks.map((e=>[e.id,e.peerScrapeStatus,e.spamFollowersStatus,e.spamFollowingsStatus].join(":"))).join("-")}_${t}`}),Nt)}};const Dt={},_t={};async function Nt(){Et(),Bt()}async function Et(){const e=Et,t=j().model.state.insights.tasks.find((e=>"running"===e.peerScrapeStatus));if(!t){const t=j().model.state.insights.tasks.find((e=>"pending"===e.peerScrapeStatus));if(!t)return;if(e.isPendingInProgress)return;return e.isPendingInProgress=!0,await async function(e){const t=vt.getTaskKey(e);await _().idbController.delete(t),delete Dt[e]}(t.id),b().default.startPendingTask(t.id),function(e=0){U().stateProxy.hasProPaid()&&C().gaController.sendEvent("user","pro-paid-usage:insights");j().transaction((t=>{t.billing.trial.insights+=e}))}(1),void(e.isPendingInProgress=!1)}const s=await Lt(t.id);if(e.isInProgress)return;e.isInProgress=!0;const a=[yt,Tt,Pt],n=a.find((e=>e.canRun(s)));if(!n)return;try{n===yt?await n.step(s):await dt.addTask((async()=>n.step(s)))}catch(e){console.error(e),b().default.setTaskError.dispatch(t.id,{code:e.code,message:(o=e.code,{[F().ec.noNetwork]:"Could not connect to instagram.com",[F().ec.timedOut]:"Request to instagram.com timed out",[F().ec.suspended]:"Instagram returned error 400, suspended",[F().ec.forbidden]:"Instagram returned error 403, forbidden",[F().ec.notFound]:"Instagram returned error 404, not found",[F().ec.tooManyRequests]:"Instagram returned error 429, too many requests",[F().ec.serverIsDown]:"Instagram returned error 500, server is down",[F().ec.badGateway]:"Instagram returned error 502, bad gateway",[F().ec.serviceUnavailable]:"Instagram returned error 503, service unavailable"}[o]||"Oops, an error occurred")})}var o;Mt(s),await Ht(s),a.find((e=>e.canRun(s)))||b().default.setTaskStatusCompleted.dispatch(t.id),Nt();const r=n===yt?q().sleepTimes.posts:q().sleepTimes.peers;await $().default(r),e.isInProgress=!1,Nt()}async function Bt(){if("ok"!==j().model.state.insights.spamcheck.status)return;const e=Bt,t=j().model.state.insights.tasks.find((e=>"running"===e.spamFollowersStatus||"running"===e.spamFollowingsStatus));if(!t){const t=function(){const e=j().model.state.insights.tasks;let t=e.find((e=>"pending"===e.spamFollowersStatus&&("running"===e.peerScrapeStatus||"completed"===e.peerScrapeStatus)));if(t)return{task:t,type:"followers"};if(t=e.find((e=>"pending"===e.spamFollowingsStatus&&e.resultCounters.followingsCount>0)),t)return{task:t,type:"followings"};return{task:null}}();if(!t.task)return;if(e.isPendingInProgress)return;return e.isPendingInProgress=!0,await async function(e,t){const s=await Lt(e.id);"followers"===t?s.results.spamFollowers={list:[],percent:null,indexes:[],usedIndexes:[]}:"followings"===t&&(s.results.spamFollowings={list:[],percent:null,indexes:[],usedIndexes:[]});await Ht(s)}(t.task,t.type),b().default.startSpamPendingTask.dispatch(t.task.id),void(e.isPendingInProgress=!1)}let s;"running"===t.spamFollowersStatus?s="followers":"running"===t.spamFollowingsStatus&&(s="followings");const a=await Lt(t.id);jt(s,a);const n={followers:Ft,followings:Ot}[s];if(n.canRun(a)&&!e.isInProgress){e.isInProgress=!0;try{await n.step(a)}catch(e){b().default.setTaskSpamStatusPlanned.dispatch(a.task.id,s)}Mt(a),await Ht(a),jt(s,a),await $().default(q().sleepTimes.user),e.isInProgress=!1,Nt()}}async function Lt(e){if(!Dt[e]){const t=vt.getTaskKey(e);let s=await _().idbController.get(t);s||(s={basePosts:{list:[],lastPage:null},baseFollowers:{list:[],lastPage:null},baseFollowings:{list:[],lastPage:null},spamFollowers:{list:[],percent:null,indexes:[],usedIndexes:[]},spamFollowings:{list:[],percent:null,indexes:[],usedIndexes:[]}}),Dt[e]={userId:j().model.state.authStatus.userId,shared:_t,task:j().model.state.insights.tasks.find((t=>t.id===e)),responseTimePosts:null,responseTimePeers:null,responseTimeUser:null,results:s}}return Dt[e]}function Mt(e){const t=e.shared.netStats;e.responseTimePosts&&(t.avgResponseTimePosts?t.avgResponseTimePosts=(t.avgResponseTimePosts+e.responseTimePosts)/2:t.avgResponseTimePosts=e.responseTimePosts),e.responseTimePeers&&(t.avgResponseTimePeers?t.avgResponseTimePeers=(t.avgResponseTimePeers+e.responseTimePeers)/2:t.avgResponseTimePeers=e.responseTimePeers),e.responseTimeUser&&(t.avgResponseTimeUser?t.avgResponseTimeUser=(t.avgResponseTimeUser+e.responseTimeUser)/2:t.avgResponseTimeUser=e.responseTimeUser),b().default.setNetStats.dispatch(t)}async function Ht(e){const t=vt.getTaskKey(e.task.id);await _().idbController.set(t,e.results),b().default.updateTaskResultCounters.dispatch(e.task.id,{postsCount:e.results.basePosts.list.length,followersCount:e.results.baseFollowers.list.length,followingsCount:e.results.baseFollowings.list.length,spamFollowersCount:e.results.spamFollowers.list.length,spamFollowingsCount:e.results.spamFollowings.list.length,spamFollowersPercent:e.results.spamFollowers.percent,spamFollowingsPercent:e.results.spamFollowings.percent})}function jt(e,t){"ok"===j().model.state.insights.spamcheck.status&&("followers"!==e||Tt.canRun(t)||Ft.canRun(t))&&("followings"!==e||Tt.canRun(t)||Pt.canRun(t)||Ot.canRun(t))||b().default.setTaskSpamStatusCompleted.dispatch(t.task.id,e)}var Jt={init:async function(){j().model.state.insights.tasks.forEach((e=>{"number"!=typeof e.resultCounters.userCredibility&&b().default.updateCredibility.dispatch(e.id)})),W().chromeBus.on("insights.get-task-results.users",Vt),W().chromeBus.on("insights.get-task-results.posts",Gt),W().chromeBus.on("insights.get-credibility-grade",Wt),qt.init(),function(){let e;j().model.observe((e=>e.insights.spamcheck),(t=>{e&&(clearTimeout(e),e=null),"ok"!==t.status&&(e=setTimeout((()=>{b().default.enableSpamAnalysis.dispatch()}),t.disabledTill-Date.now()))}))}(),zt(),async function(){if(H().env.is.development)return;const e=j().model.observe((e=>e.authStatus.userId),(async t=>{if(!t)return;setTimeout((()=>e()));const s=Date.now();K().fetcher.ignoreCache(),await F().igApi.fetchUserDetails("instagram",{incognito:!0});const a=Date.now();b().default.setNetStats.dispatch({avgResponseTimeUser:a-s,avgResponseTimePosts:a-s}),K().fetcher.ignoreCache();const n=await F().igApi.fetchRootFollowersPage("instagram");if(n.error)return;const o=n.result;await $().default(2*N().SECOND);const r=Date.now();K().fetcher.ignoreCache(),await F().igApi.fetchNextFollowersPage(o);const i=Date.now();b().default.setNetStats.dispatch({avgResponseTimePeers:i-r})}))}(),async function(){for(const e of j().model.state.insights.tasks){if(!e.user||"number"==typeof e.user.postsCount)continue;const t=e.user.username,s=(await F().igApi.fetchUserDetails(t)).result;s&&(b().default.setUser.dispatch(e.id,s),await $().default(2e3))}}(),function(){const e=36e5,t=q().insights.spamMaxRequests/q().insights.spamLockDuration*e;setInterval((()=>{b().default.incrementSpamRequestsCount.dispatch(-t)}),e)}()}};async function Vt(e){const t=vt.getTaskKey(e),s=await _().idbController.get(t);return{followers:s?s.baseFollowers.list:[],followings:s?s.baseFollowings.list:[]}}async function Gt(e){const t=vt.getTaskKey(e),s=await _().idbController.get(t);return{posts:s?s.basePosts.list:[]}}function Wt(e){const t=F().igApi.createUserObject(e),s=j().model.state.authStatus.userId,a=v().botOrNot.getCredibility(t,s);return w().default(a)}async function zt(){const e=[];(await _().idbController.getAllKeys()).forEach((t=>{const s=vt.extractTaskIdFromKey(t);s&&e.push(s)}));const t=j().model.state.insights.tasks.map((e=>e.id));Object.values(j().model.state.userStates).forEach((e=>{const s=e.insights.tasks.map((e=>e.id));t.push(...s)}));e.filter((e=>!t.includes(e))).forEach((e=>{const t=vt.getTaskKey(e);_().idbController.delete(t)})),setTimeout(zt,6e4)}const Kt=e=>"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e?JSON.stringify(e):e,$t=function(e){console.log("%c[test] "+Kt(e),"color: #3d9d30")},Qt=function(e){console.log("%c[test] "+Kt(e),"color: #e94b35")},Yt=function(e){console.log(Kt(e))},Zt={init(){window.env=H().env,window.ig=q().ig,window.utils=m().utils,window.callAsync=R().default,window.createUrl=G().default,window.createAlarm=p().default,window.AsyncQueue=Y,window.ls=h().default,window.safe=I().default,window.igApi=F().igApi,window.fbApi=oe,window.Response=F().Response,window.IgUsersPage=F().IgUsersPage,window.chromeBus=W().chromeBus,window.iframeBus=g().iframeBus,window.botOrNot=v().botOrNot,window.abTestingController=f().abTestingController,window.gaController=C().gaController,window.fetcher=K().fetcher,window.billing=he,window.idbController=_().idbController,window.sentryController=z().sentryController,window.overseerController=et,window.analyticsController=ft,window.insightsController=Jt,window.setState=this.setState,window.downgradeVersion=this.downgradeVersion,window.testGetSkuDetails=this.testGetSkuDetails,window.testGetPurchases=this.testGetPurchases,window.testFetchUsername=this.testFetchUsername,window.testFetchUserId=this.testFetchUserId,window.testAll=this.testAll,window.errorsDelta=this.errorsDelta,window.activityDelta=this.activityDelta,window.countMadeActions=this.countMadeActions,(H().env.is.development||H().env.is.beta)&&(window.model=j().model,window.transaction=j().transaction,window.storageController=d().storageController,window.stateProxy=U().stateProxy,window.unbanAllTasks=this.unbanAllTasks,Object.assign(window,N()),this.defineCommit())},countMadeActions(e=86400){const t=window.__debug.state,s=m().utils.getUnixTime(),a={likes:0};for(let n=0;n<t.stats.activity.length;n++){const o=t.stats.activity[n];if(s-o.on>e)break;"like"===o.type&&a.likes++}return a},errorsDelta(){const e=window.__debug.errors;let t=e[0].on;e.forEach((e=>{log((t-e.on)/60),t=e.on}))},activityDelta(){const e=window.__debug.state.stats.activity;let t=e[0].on;window.__debug.state.stats.activity=e.map((e=>{const s=t;return t=e.on,{...e,since:Math.floor((s-e.on)/60)}}))},setState(e){const t=M().default.cloneDeep(e);U().replaceState.dispatch(t)},downgradeVersion(){const e=M().default.cloneDeep(j().model.state);e.version=e.version-1,U().replaceState.dispatch(e)},unbanAllTasks(){const e=M().default.cloneDeep(j().model.state);e.stats.activity=e.stats.activity.filter((e=>"ban"!==e.type)),U().replaceState.dispatch(e)},testGetSkuDetails:()=>($t("billing.getSkuDetails..."),new Promise((e=>{google.payments.inapp.getSkuDetails({parameters:{env:"prod"},success:t=>{$t("  success:"),Yt(t),e()},failure:t=>{H().env.is.development&&t&&t.response&&"INVALID_RESPONSE_ERROR"===t.response.errorType?$t("  success:"):Qt("  failure:"),Yt(t),e()}})}))),testGetPurchases:()=>($t("billing.getPurchases..."),new Promise((e=>{google.payments.inapp.getPurchases({parameters:{env:"prod"},success:t=>{$t("  success:"),Yt(t),e()},failure:t=>{Qt("  failure:"),Yt(t),e()}})}))),testFetchUsername:()=>($t("igApi.fetchUsername..."),F().igApi.fetchUsername().then((e=>{$t("  success:"),Yt(e)})).catch((e=>{Qt("  failure:"),Yt(e)}))),testFetchUserId:e=>($t("igApi.fetchUserId..."),F().igApi.fetchUserId(e).then((e=>($t("  success:"),Yt(e),e.result))).then((()=>{const e=M().default.cloneDeep(j().model.state);U().replaceState.dispatch(e)})).catch((e=>{Qt("  failure:"),Yt(e)}))),testAll(){new Promise((e=>{setTimeout(e,0)})).then(Zt.testGetSkuDetails).then(Zt.testGetPurchases).then(Zt.testFetchUsername).then(Zt.testFetchUserId)},defineCommit(){Object.defineProperty(window,"commit",{get:()=>(this.setState(j().model.state),null)})}};var Xt={init:async function(){await async function(){for(const e of es){const t=(await R().default(chrome.cookies.getAll,{url:e})).filter((e=>"unspecified"===e.sameSite));await Promise.all(t.map((async t=>{e.startsWith("http://")?await R().default(chrome.cookies.remove,{url:e,name:t.name}):await R().default(chrome.cookies.set,{url:e,name:t.name,value:t.value,domain:t.domain,path:t.path,secure:!0,httpOnly:t.httpOnly,sameSite:"no_restriction",expirationDate:t.expirationDate,storeId:t.storeId})})))}}(),chrome.webRequest.onHeadersReceived.addListener(ts,{urls:es},Te.getVersion()<72?["blocking","responseHeaders"]:["blocking","responseHeaders","extraHeaders"])}};const es=["http://*.instagram.com/*","https://*.instagram.com/*","https://*.facebook.com/*","http://*.doubleclick.net/*"];function ts(e){return e.responseHeaders.forEach((e=>{"set-cookie"===e.name&&-1!==e.value.indexOf("Secure")&&(-1!==e.value.indexOf("SameSite=Strict")?e.value=e.value.replace(/SameSite=Strict/g,"SameSite=None"):-1!==e.value.indexOf("SameSite=Lax")?e.value=e.value.replace(/SameSite=Lax/g,"SameSite=None"):e.value=e.value.replace(/; Secure/g,"; SameSite=None; Secure"))})),{responseHeaders:e.responseHeaders}}function ss(e){return e&&e.__esModule?e:{default:e}}var as={};Q(as);var ns={update(e){if(!e.userStates)return e;const t={...e,billing:{...e.billing,trial:{...e.billing.trial,dmAdvanced:0}}};return delete t.billing.trial.dmGhost,t}};as.default=ns;var os={};Q(os);var rs={update:e=>({...e,analytics:{...e.analytics,trialLastViewedFollowerId:null,trialLastViewedUnfollowerId:null}})};os.default=rs;var is={};Q(is);var ls={update:e=>(async function(){const e=await _().idbController.getAllKeys();for(const t of e)(t.startsWith("schedule.fcs-post-preview:")||t.startsWith("schedule.local-post:"))&&_().idbController.delete(t)}(),e)};is.default=ls;var us={};Q(us);var cs={update:e=>({...e,schedule:{...e.schedule,localPosts:[]}})};us.default=cs;var ds={};Q(ds);var fs={update:e=>e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,dmAdvanced:Math.max(e.billing.trial.dmAdvanced-50,0)}}}:e};ds.default=fs;var gs={};Q(gs);var hs={update(e){const t={...e,schedule:{...e.schedule,isSetupPanelShown:!1,setup:{...e.schedule.setup}}};return delete t.schedule.setup.selectedSetupType,t}};gs.default=hs;var ps={};Q(ps);var ms={update:e=>e.userStates?{...e,zen:{enabled:!1}}:e};ps.default=ms;var ws={};Q(ws);var vs={update:e=>e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,zen:0}},zen:{...e.zen,lastTrialUpdateOn:null}}:e};ws.default=vs;var bs={};Q(bs);var ys={update:e=>({...e,insights:{...e.insights,lastTaskTimestamps:[]}})};bs.default=ys;var Ss={};Q(Ss);var ks={update:e=>({...e,billing:{...e.billing,trial:{...e.billing.trial,coverAssist:0}},coverAssist:{shown:!1,loading:!0,videoUrl:null,coverUrl:null,selectedTabId:"auto",showGrid:!1,gridImages:[],frameGalleryImages:[],frameGallerySelectedImage:null,frameSelectImage:null,frameSelectValue:null,frameUploadImage:null}})};Ss.default=ks;var Is={};Q(Is);var Ts={update:e=>e.userStates?{...e,whatsNew:e.whatsNew.filter((e=>"youtube-giveaway"!==e.id))}:e};Is.default=Ts;var Ps={};Q(Ps);var Cs={update(e){if(!e.userStates)return e;const t={...e.billing.fspring},s={};return t.begin&&(s["inssist-pro-monthly"]={active:t.active,state:t.state,begin:t.begin,next:t.next}),delete t.active,delete t.state,delete t.begin,delete t.next,delete t.sku,{...e,billing:{...e.billing,fspring:t,subscriptions:s,products:{}}}}};Ps.default=Cs;var As={};Q(As);var Rs={update:e=>e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,addLinkToStory:0}}}:e};As.default=Rs;var Us={};Q(Us);var xs={update(e){const t={...e,authStatus:{...e.authStatus,cookies:{ig:{sessionId:e.authStatus.sessionIdCookie},fb:[]}},schedule:{...e.schedule,fcsSetup:{checking:!1,connected:!1,connecting:!1,showPanel:!1,showInstructions:!1,showError:!1}}};return delete t.authStatus.sessionIdCookie,delete t.schedule.setup,delete t.schedule.isVerificationRequired,delete t.schedule.isSetupPanelShown,t}};Us.default=xs;var Fs={};Q(Fs);var Os={update(e){const t={...e,authStatus:{...e.authStatus,cookies:{...e.authStatus.cookies}}};return delete t.authStatus.cookies.ig,t}};Fs.default=Os;var qs={};Q(qs);var Ds={update:e=>e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,repost:0}}}:e};qs.default=Ds;var _s={};Q(_s);var Ns={update:e=>e.userStates?{...e,whatsNew:e.whatsNew.map((e=>{let t;return t="Share Post to Story"===e.header?"v10.0.1":e.subheader,{id:t,acknowledged:e.acknowledged}}))}:e};_s.default=Ns;var Es={};Q(Es);var Bs={update(e){if(!e.userStates)return e;return e.whatsNew.find((e=>"Reposting"===e.id))?{...e,whatsNew:c().default().map((e=>({id:e.id,acknowledged:!0})))}:e}};Es.default=Bs;var Ls={};Q(Ls);var Ms={update:e=>({...e,schedule:{...e.schedule,recentScheduledOn:null}})};Ls.default=Ms;var Hs={};Q(Hs);var js={update:e=>({...e,schedule:{...e.schedule,fcsSetup:{checking:!1,connected:!1,connecting:!1,showPanel:!1,errorCode:null}}})};Hs.default=js;var Js={};Q(Js);var Vs={update(e){if(!e.userStates)return e;const t={...e,billing:{...e.billing,trial:{...e.billing.trial}}};return delete t.billing.trial.multiaccount,t}};Js.default=Vs;var Gs={};Q(Gs);var Ws={update:e=>e.authStatus.cookies?e:{...e,authStatus:{...e.authStatus,cookies:{igSessionId:null,fb:[]}}}};Gs.default=Ws;var zs={};Q(zs);var Ks={update:e=>({...e,analytics:{...e.analytics,filters:{query:"",accounts:"all"}},insights:{...e.insights,filters:{query:"",accounts:"all",posts:"all"},tasks:e.insights.tasks.map((e=>{const t={...e};return delete t.followersTableSkip,delete t.followingsTableSkip,t}))}})};zs.default=Ks;var $s={};Q($s);var Qs={update:e=>({...e,analytics:{...e.analytics,loading:!1},insights:{...e.insights,loading:!1}})};$s.default=Qs;var Ys={};Q(Ys);var Zs={update(e){if(!e.userStates){const t={...e};return delete t.tagAssist,t}return{...e,tagAssist:{shown:!1,collections:[],loadingTags:[],selectedTags:[],loadedTagData:{},errorCode:null,search:{query:"",loading:!1,relevantTags:[]}}}}};Ys.default=Zs;var Xs={};Q(Xs);var ea={update(e){const t={...e,insights:{...e.insights}};return delete t.insights.isReportOpen,delete t.insights.selectedTaskId,e.userStates&&"tab-insights"===e.sidebar.selectedTabId&&(t.sidebar={...e.sidebar,selectedTabId:"tab-analytics"}),t}};Xs.default=ea;var ta={};Q(ta);var sa={update:e=>e.userStates?{...e,whatsNew:e.whatsNew.filter((e=>"earlyadopter-coupon"!==e.id))}:e};ta.default=sa;var aa={};Q(aa);var na={update(e){if(!e.userStates)return e;const t={...e,tagAssist:{...e.tagAssist,query:"",searching:!1,foundTags:[]}};return delete t.tagAssist.search,delete t.tagAssist.loadedTagData,t}};aa.default=na;var oa={};Q(oa);var ra={update:e=>e.userStates?{...e,tagAssist:{...e.tagAssist,latinOnly:!1}}:e};oa.default=ra;var ia={};Q(ia);var la={update:e=>e.userStates?{...e,tagAssist:{...e.tagAssist,accountStats:{}}}:e};ia.default=la;var ua={};Q(ua);var ca={update(e){if(!e.userStates)return e;const t={...e,tagAssist:{...e.tagAssist,relevantTags:[]}};return delete t.tagAssist.foundTags,t}};ua.default=ca;var da={};Q(da);var fa={update:e=>(e.userStates&&_().idbController.delete("tag-assist.tag-data"),e)};da.default=fa;var ga={};Q(ga);var ha={update:e=>e.userStates?{...e,tagAssist:{...e.tagAssist,ladderConfig:{lastUpdateOn:Date.now(),tiers:{low:.7,medium:1.5,high:5}}}}:e};ga.default=ha;var pa={};Q(pa);var ma={update:e=>e.userStates?{...e,tagAssist:{...e.tagAssist,ladder:null}}:e};pa.default=ma;var wa={};Q(wa);var va={update:e=>(e.userStates&&_().idbController.delete("tag-assist.tag-data"),e)};wa.default=va;var ba={};Q(ba);var ya={update:e=>e.userStates?{...e,tagAssist:{...e.tagAssist,selectedTabId:"search"}}:e};ba.default=ya;var Sa={};Q(Sa);var ka={update:e=>e.userStates?{...e,tagAssist:{...e.tagAssist,newCollection:{name:"",text:"",showForm:!1},collections:e.tagAssist.collections.map((e=>({...e,editing:!1,editName:"",editText:""})))}}:e};Sa.default=ka;var Ia={};Q(Ia);var Ta={update(e){if(!e.userStates)return e;const t={...e,tagAssist:{...e.tagAssist,selectedGroupId:"low",ladderLoadingTags:[],collectionsTagData:{},collectionsLoadingTags:[]}};return delete t.tagAssist.relevantTags,delete t.tagAssist.loadingTags,t}};Ia.default=Ta;var Pa={};Q(Pa);var Ca={update:e=>e.userStates?{...e,tagAssist:{...e.tagAssist,engagementSort:null}}:e};Pa.default=Ca;var Aa={};Q(Aa);var Ra={update:e=>e.userStates?{...e,tagAssist:{...e.tagAssist,lastDayUsedOn:null},billing:{...e.billing,trial:{...e.billing.trial,tagAssist:0}}}:e};Aa.default=Ra;var Ua={};Q(Ua);var xa={update(e){if(!e.userStates)return e;const t=e.billing.trial;return{...e,billing:{...e.billing,trial:{...t,installedOn:t.installedOn||Date.now(),dmAdvanced:t.dmAdvanced||0,schedule:t.schedule||0,insights:t.insights||0,analytics:t.analytics||0,zen:t.zen||0,coverAssist:t.coverAssist||0,tagAssist:t.tagAssist||0,addLinkToStory:t.addLinkToStory||0,postsPublished:t.postsPublished||0,storiesPublished:t.storiesPublished||0,dmsSent:t.dmsSent||0,repost:t.repost||0}}}}};Ua.default=xa;var Fa={};Q(Fa);var Oa={update(e){if(!e.userStates)return e;const t={...e,tagAssist:{...e.tagAssist,ladderEngagementSort:e.tagAssist.engagementSort,summaryEngagementSort:null}};return delete t.tagAssist.engagementSort,t}};Fa.default=Oa;var qa={};Q(qa);var Da={update:e=>e.userStates?{...e,tagAssist:{...e.tagAssist,preselectedTags:[],preselectedText:""}}:e};qa.default=Da;var _a={};Q(_a);var Na={update:e=>({...e,reels:{supported:!1}})};_a.default=Na;var Ea={};Q(Ea);var Ba={update:e=>e.userStates?{...e,billing:{...e.billing,trial:{...e.billing.trial,reels:0}}}:e};Ea.default=Ba;var La={};Q(La);var Ma={update:e=>({...e,reels:{...e.reels,creating:!1}})};La.default=Ma;var Ha={};Q(Ha);var ja={update:e=>({...e,authStatus:{...e.authStatus,isMobileSession:!1}})};Ha.default=ja;var Ja={};Q(Ja);var Va={update:e=>e.userStates?{...e,billing:{...e.billing,recentFeature:null}}:e};Ja.default=Va;var Ga={};Q(Ga);var Wa={update(e){const t={...e,schedule:{...e.schedule,loading:!1}};return delete t.schedule.isRefreshingGrid,t}};Ga.default=Wa;var za={};Q(za);var Ka={update(e){const t={...e,schedule:{...e.schedule,navigation:{...e.schedule.navigation}}};return delete t.schedule.navigation.fcsTitle,t}};za.default=Ka;var $a={};Q($a);var Qa={update:e=>({...e,schedule:{...e.schedule,filters:{...e.schedule.filters,mediaTypes:e.schedule.filters.mediaTypes.filter((e=>"igtv"!==e))}}})};$a.default=Qa;var Ya={};Q(Ya);var Za={update(e){const t={...e,schedule:{...e.schedule,posts:[...e.schedule.localPosts.map((e=>({id:e.id,source:"local",type:e.type,status:"draft",image:e.image,preview:null,imageAvgColor:e.imageAverageColor,on:e.on,createdOn:Date.now(),stats:null,crosspostToFb:null,draftOrder:e.draftOrder}))),...e.schedule.fcsPosts.map((e=>({id:e.id,source:"fcs",type:e.type,status:e.status,image:e.image,preview:e.preview,imageAvgColor:e.imageAverageColor,on:e.on,stats:e.stats?{...e.stats}:null,crosspostToFb:e.crosspostToFb,draftOrder:e.draftOrder})))]}};return delete t.schedule.igPosts,delete t.schedule.fcsPosts,delete t.schedule.localPosts,t}};Ya.default=Za;var Xa={};Q(Xa);var en={update(e){const t={...e,schedule:{...e.schedule}};if(e.userStates){const s=[e,...Object.values(e.userStates)];t.acknowledged={...e.acknowledged,scheduleDndTip:s.some((e=>e.schedule.isDndTipAcknowledged))?Date.now():-1}}return delete t.schedule.isDndTipAcknowledged,t}};Xa.default=en;var tn={};Q(tn);var sn={update(e){const t={...e};return t.userStates||delete t.sidebar,t}};tn.default=sn;var an={};Q(an);var nn={update:e=>e.igView?{...e,igView:{...e.igView,fullscreenWidth:460,withBorder:!0}}:e};an.default=nn;var on={};Q(on);var rn={update(e){const t={...e,analytics:{...e.analytics,runAutomatically:!0,runningJobId:null,lastScanOn:null,nextScanOn:null,error:null,isReportOpen:!0,selectedCard:"nFollowers"},ff:{isActionBlockShown:!1,followStatus:{}}};return delete t.insights.isActionBlockShown,t}};on.default=rn;var ln={};Q(ln);var un={update(e){const t={...e,igTask:e.ff};return delete t.ff,t}};ln.default=un;var cn={};Q(cn);var dn={update:e=>({...e,igTask:{...e.igTask,likeStatus:{}}})};cn.default=dn;var fn={};Q(fn);var gn={update(e){const t={...e,igTask:{...e.igTask,actionBlockCode:null}};return delete t.igTask.isActionBlockShown,t}};fn.default=gn;var hn={};Q(hn);var pn={update:e=>e.userStates?e:{...e,authStatus:{userId:null,username:null,avatarUrl:null,sessionIdCookie:null,isLoggedIn:!1}}};hn.default=pn;var mn={};Q(mn);var wn={update:e=>e.userStates?{...e,multiaccount:{userIds:e.authStatus.isLoggedIn?[e.authStatus.userId]:[],addingNewAccount:!1}}:e};mn.default=wn;var vn={};Q(vn);var bn={update(e){if(!e.userStates)return e;const t=e.multiaccount.userIds;return{...e,multiaccount:{...e.multiaccount,selectedUserId:t.length?t[t.length-1]:null}}}};vn.default=bn;var yn={};Q(yn);var Sn={update:e=>e.userStates?{...e,igView:{...e.igView,creationCardShown:!1}}:e};yn.default=Sn;var kn={};Q(kn);var In={update:e=>e.userStates?{...e,billing:{...e.billing,recordedUsernames:[]}}:e};kn.default=In;var Tn={};Q(Tn);var Pn={update(e){const t={...e,schedule:{...e.schedule,setup:{...e.schedule.setup,stepIndex:null,stepTitle:null}}};return delete t.schedule.setup.progress,t}};Tn.default=Pn;var Cn={};Q(Cn);var An={update:e=>e.userStates?{...e,followUs:{shown:!1,acknowledged:!1}}:e};Cn.default=An;var Rn={};Q(Rn);var Un={update(e){if(!e.userStates)return e;const t={...e,acknowledged:{...e.acknowledged},rateUs:{shown:!1,acknowledged:-1!==e.acknowledged.rateUs}};return delete t.acknowledged.rateUs,t}};Rn.default=Un;var xn={};Q(xn);var Fn={update(e){if(!e.userStates)return e;const t=Date.now(),s={...e,acknowledged:{...e.acknowledged,rateUs:e.rateUs.acknowledged?t:-1,followUs:e.followUs.acknowledged?t:-1},rateUs:{...e.rateUs},followUs:{...e.followUs}};return delete s.rateUs.acknowledged,delete s.followUs.acknowledged,s}};xn.default=Fn;var On={};Q(On);var qn={update(e){if(!e.userStates)return e;const t={...e,userDetails:{}};return delete t.billing.promostory.followersCount,t}};On.default=qn;var Dn={};Q(Dn);var _n={update(e){if(!e.userStates)return e;const t={...e,acknowledged:{...e.acknowledged}};return delete t.acknowledged.postLimitations,t}};Dn.default=_n;var Nn={};Q(Nn);var En={update:e=>e};Nn.default=En;var Bn={};Q(Bn);var Ln={update:e=>({...e,schedule:{...e.schedule,fcsPosts:e.schedule.fcsPosts.map((e=>{const t={...e};return delete t.firstMediaId,t}))}})};Bn.default=Ln;var Mn={};Q(Mn);var Hn={update:e=>({...e,schedule:{...e.schedule,drafts:[]}})};Mn.default=Hn;var jn={};Q(jn);var Jn={update(e){const t={...e,dm:{...e.dm,ghostModeEnabled:!1,ghostModeFailed:!1}};return delete t.dm.showBadge,t}};jn.default=Jn;var Vn={};Q(Vn);var Gn={update(e){const t={...e,schedule:{...e.schedule,filters:{...e.schedule.filters,statuses:[...e.schedule.filters.statuses,"local"]}}};return delete t.dm.showBadge,t}};Vn.default=Gn;var Wn={};Q(Wn);var zn={update(e){const t={...e,schedule:{...e.schedule,localPosts:e.schedule.drafts}};return delete t.schedule.drafts,async function(){let e;try{e=await _().idbController.getAllKeys()}catch(e){return}for(const t of e){if(!t.startsWith("schedule.drafts:"))continue;const e=t.replace("schedule.drafts:",""),s=await _().idbController.get(t);_().idbController.set("schedule.local-posts:"+e,s),_().idbController.delete(t)}}(),t}};Wn.default=zn;var Kn={};Q(Kn);var $n={update:e=>(async function(){let e;try{e=await _().idbController.getAllKeys()}catch(e){return}for(const t of e)(t.startsWith("schedule.drafts:")||t.startsWith("schedule.local-posts:"))&&_().idbController.delete(t)}(),{...e,schedule:{...e.schedule,bulkUploadErrors:[]}})};Kn.default=$n;var Qn={};Q(Qn);var Yn={update:e=>({...e,schedule:{...e.schedule,localPosts:[]}})};Qn.default=Yn;var Zn={};Q(Zn);var Xn={update:e=>(async function(){const e=await I().default((()=>_().idbController.getAllKeys()),[]);for(const t of e)t.startsWith("schedule.local-posts:")&&_().idbController.delete(t)}(),{...e,schedule:{...e.schedule,localPosts:[]}})};Zn.default=Xn;var eo={};Q(eo);var to={update(e){const t={...e,schedule:{...e.schedule}};return delete t.schedule.csPosts,delete t.schedule.csError,delete t.schedule.csFailed,delete t.schedule.lastCsPostsUpdateOn,delete t.schedule.navigation.csTitle,delete t.schedule.navigation.isCsLoading,delete t.schedule.setup.isCsConnected,t}};eo.default=to;var so={};Q(so);var ao={update(e){if(!e.userStates)return e;const t={...e,billing:{...e.billing,trial:{...e.billing.trial,dmGhost:0,schedule:0,insights:0,analytics:0,multiaccount:0}}};return delete t.billing.promostory,t}};so.default=ao;var no={};Q(no);var oo={update(e){const t={...e,insights:{...e.insights}};return delete t.insights.availability,t}};no.default=oo;const ro={"version-100":ss(as).default,"version-101":ss(os).default,"version-102":ss(is).default,"version-103":ss(us).default,"version-104":ss(ds).default,"version-105":ss(gs).default,"version-106":ss(ps).default,"version-107":ss(ws).default,"version-108":ss(bs).default,"version-109":ss(Ss).default,"version-110":ss(Is).default,"version-111":ss(Ps).default,"version-112":ss(As).default,"version-113":ss(Us).default,"version-114":ss(Fs).default,"version-115":ss(qs).default,"version-116":ss(_s).default,"version-117":ss(Es).default,"version-118":ss(Ls).default,"version-119":ss(Hs).default,"version-120":ss(Js).default,"version-121":ss(Gs).default,"version-122":ss(zs).default,"version-123":ss($s).default,"version-124":ss(Ys).default,"version-125":ss(Xs).default,"version-126":ss(ta).default,"version-127":ss(aa).default,"version-128":ss(oa).default,"version-129":ss(ia).default,"version-130":ss(ua).default,"version-131":ss(da).default,"version-132":ss(ga).default,"version-133":ss(pa).default,"version-134":ss(wa).default,"version-135":ss(ba).default,"version-136":ss(Sa).default,"version-137":ss(Ia).default,"version-138":ss(Pa).default,"version-139":ss(Aa).default,"version-140":ss(Ua).default,"version-141":ss(Fa).default,"version-142":ss(qa).default,"version-143":ss(_a).default,"version-144":ss(Ea).default,"version-145":ss(La).default,"version-146":ss(Ha).default,"version-147":ss(Ja).default,"version-148":ss(Ga).default,"version-149":ss(za).default,"version-150":ss($a).default,"version-151":ss(Ya).default,"version-152":ss(Xa).default,"version-71":ss(tn).default,"version-72":ss(an).default,"version-73":ss(on).default,"version-74":ss(ln).default,"version-75":ss(cn).default,"version-76":ss(fn).default,"version-77":ss(hn).default,"version-78":ss(mn).default,"version-79":ss(vn).default,"version-80":ss(yn).default,"version-81":ss(kn).default,"version-82":ss(Tn).default,"version-83":ss(Cn).default,"version-84":ss(Rn).default,"version-85":ss(xn).default,"version-86":ss(On).default,"version-87":ss(Dn).default,"version-88":ss(Nn).default,"version-89":ss(Bn).default,"version-90":ss(Mn).default,"version-91":ss(jn).default,"version-92":ss(Vn).default,"version-93":ss(Wn).default,"version-94":ss(Kn).default,"version-95":ss(Qn).default,"version-96":ss(Zn).default,"version-97":ss(eo).default,"version-98":ss(so).default,"version-99":ss(no).default},io={versioners:{},init(){const e=/version-(\d+)/i;Object.keys(ro).map((t=>{const s=parseInt(t.match(e)[1]);return{key:t,version:s}})).sort(((e,t)=>e.version-t.version)).forEach((e=>{this.versioners[e.version]=ro[e.key]}))},update(e){let t=e,s=t.version||0;log("versioner: model version is "+s);const a=u().default().version;for(;s<a;){log("versioner: applying versioner "+(s+1));const e=this.versioners[s+1];t=e.update(t),t.version=s+1;const a=t.backups||t.userStates;for(const t in a){const n=a[t];try{a[t]=e.update(n),a[t].version=s+1}catch(e){delete a[t]}}s++}return t}};io.init();const lo={update(e){const t=Array.isArray(e.whatsNew)?e.whatsNew:[],s=c().default();let a=!1;const n=s.map((e=>{let s;if(a)s=!0;else{const n=t.find((t=>t.id===e.id));s=n&&n.acknowledged||!1,s&&(a=!0)}return{id:e.id,acknowledged:s}}));return{...e,whatsNew:n}}};var uo=j().action("state.setup-default-state",(e=>e.whatsNew?e:{...u().default(),...l().default()}));const co={init(){uo.dispatch(),this._update()},_update(){let e=j().model.state;e=io.update(e),e=lo.update(e),e!==j().model.state&&i().default.dispatch(e)}},fo={status:null,init(){this._subscribeToInflux()},_subscribeToInflux(){j().model.observe((e=>e.whatsNew.some((e=>!e.acknowledged))?"updated":"normal"),(e=>{this._updateBadge(e)}))},_updateBadge(e){this.status!==e&&chrome.browserAction.setIcon({path:{48:`img/icon-badge-48-${e}.png`}})}};var go={init:function(){chrome.runtime.setUninstallURL("https://forms.gle/L6nZ8YUTqUspM34s7")}};const ho={init(){this._goOnline=this._goOnline.bind(this),this._goOffline=this._goOffline.bind(this),this._recoverIfOffline=this._recoverIfOffline.bind(this),window.addEventListener("online",this._goOnline,!1),window.addEventListener("offline",this._goOffline,!1),setInterval(this._recoverIfOffline,3e5)},_goOnline(){log("starter: going online"),null===j().model.state.authStatus.userId&&_e.updateUser()},_goOffline(){log("starter: going offline"),null!==j().model.state.authStatus.userId&&_e.updateUser()},_recoverIfOffline(){null===j().model.state.authStatus.userId&&(log("starter: trying to recover from offline"),_e.updateUser())}};var po={init:function(){chrome.cookies.onChanged.addListener((async({cookie:e,cause:t,removed:s})=>{if(!e.domain.includes("instagram.com"))return;if("open-in-inssist"!==e.name)return;if("explicit"!==t)return;if(s)return;const a=await R().default(chrome.windows.getLastFocused),n=await R().default(chrome.tabs.getSelected,a.id);!async function(e){const t=Number(localStorage.getItem("last-tab-id")),s=await R().default(chrome.tabs.get,t),a=e.startsWith("/direct/")&&"/direct/"!==e;a?j().transaction((e=>{e.sidebar.isOpen=!0,e.sidebar.selectedTabId="tab-dm"})):j().transaction((e=>{e.sidebar.isOpen=!1}));s?(chrome.windows.update(s.windowId,{focused:!0}),chrome.tabs.update(s.id,{active:!0}),a||W().chromeBus.send("iframe-bus","ig.ajax-go",e)):(a||localStorage.setItem("instagram-iframe-path",e),chrome.tabs.create({url:"https://app.inssist.com",active:!0}))}(e.value),await R().default(chrome.tabs.remove,n.id),chrome.cookies.remove({url:"https://www.instagram.com",name:"open-in-inssist"})}))}};var mo={init:function(){W().chromeBus.on("fusion.check-new-version",yo),W().chromeBus.on("fusion.popup-tab-id",(e=>{wo=e})),r().resetController.onReset(bo),chrome.tabs.onRemoved.addListener((e=>{e===wo&&vo&&So()})),W().chromeBus.on("fusion.update-now-click",(()=>{h().default.set("fusion.reload-popup-on-background-start",!0),So()})),h().default.get("fusion.reload-popup-on-background-start")&&(h().default.remove("fusion.reload-popup-on-background-start"),W().chromeBus.send("fusion.reload-popup")),chrome.alarms.onAlarm.addListener((async e=>{"fusion.refresh-config"===e.name&&yo()})),chrome.alarms.create("fusion.refresh-config",{when:Date.now(),periodInMinutes:1440})}};let wo,vo;function bo(){h().default.remove("fusion.last-check-on")}async function yo(){const e=15*N().MINUTE,t=Number(h().default.get("fusion.last-check-on"));if(t&&Date.now()<t+e)return;h().default.set("fusion.last-check-on",Date.now());const s=o().default(),a=`${H().env.options.apiUrl}/fusion?version=${s.version}`;K().fetcher.ignoreCache();const n=(await K().fetcher.fetchText(a,{credentials:"omit"})).replace(/&amp;/g,"&").replace(/&#34;/g,'\\"').replace(/&#39/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">"),r=JSON.parse(n);if(!r.config)return;const i=JSON.parse(JSON.stringify(s));vo=ko(i,r.config);chrome.extension.getViews({type:"tab"}).length>0?W().chromeBus.send("fusion.new-version-available"):So()}function So(){vo&&(h().default.set("fusion.config",vo),location.reload())}function ko(e,t){for(const s in t)Z(e[s])&&Z(t[s])?ko(e[s],t[s]):e[s]=t[s];return e}var Io={init:function(){W().chromeBus.on("tag-assist.send-tags-to-redis",xo),W().chromeBus.on("tag-assist.tag-fetched-from-ig",Ro),async function(){const e="tag-assist.periodic-tag-data-collection";chrome.alarms.create(e,{delayInMinutes:1,periodInMinutes:To.userTagScanPeriod/N().MINUTE}),chrome.alarms.onAlarm.addListener((async t=>{t.name===e&&async function(){if(H().env.is.development)return void console.log("collect user tags");let e,t;Object.keys(Co).forEach((e=>{const t=Co[e];Date.now()-t<To.userTagScanTtl||delete Co[e]}));e=[j().model.state,...Object.values(j().model.state.userStates)].map((e=>e.authStatus.username)).find((e=>!Co[e]));if(!e){e=((await F().igApi.fetchExplorePageUsernames()).result||[]).find((e=>!Co[e]))}if(!e)return;Co[e]=Date.now();t=(await F().igApi.fetchUserRecentTags(e)).result||[],t=t.slice(0,To.userTagScanCount);for(const e of t){const t=await F().igApi.fetchTag(e);t.error||(Ro(t.result),await $().default((5+5*Math.random())*N().SECOND))}}()}))}(),function(){let e;Po((()=>{clearTimeout(e),e=setTimeout(Uo,To.sendCollectedTagsTimeout)}))}()}};const To=H().env.options.tagAssist,Po=D().default(),Co={};let Ao={};function Ro(e){Ao[e.name]={lastScanOn:Date.now(),...e},Po()}async function Uo(){if(H().env.is.development)return console.log("send collected tags",Ao),void(Ao={});const e=Object.values(Ao);Ao={},await xo(e)}async function xo(e=[]){const t=j().model.state.authStatus.userId;if(t)try{const s=G().default(To.apiUrl,{id:t});await K().fetcher.fetch(s,{method:"POST",credentials:"omit",headers:{"content-type":"application/json"},body:JSON.stringify({tags:e.map(n().compressTag)})})}catch(e){console.error("failed to send tags to the api",e)}}var Fo={init:function(){j().model.observe((e=>e.authStatus.userId),(()=>{Oo()})),p().default({period:4*N().HOUR},(()=>{Oo()}))}};async function Oo(e=0){const t=j().model.state,s=t.authStatus.userId;if(!s)return;const o=Date.now(),r=a().default.getAccountStats(),i=r&&o-r.lastScanOn;if(i&&i<H().env.options.tagAssist.accountStatsTtl)return;const l=t.authStatus.username,u=await F().igApi.fetchUserPosts(l,42);if(u.error)return e<2?void Oo(e+1):void console.error("failed to update account stats");const c=u.result;let d=0,f=0;for(const e of c)d+=F().igApi.normalizePostStat24h(e.stats.likes,e.on),f+=F().igApi.normalizePostStat24h(e.stats.comments,e.on);c.length>0&&(d=Math.round(d/c.length),f=Math.round(f/c.length));const g=n().sortByFrequency(c.map((e=>e.caption||"")).map((e=>n().extractTags(e,!0))));j().transaction((e=>{e.tagAssist.accountStats[s]={avgLikes:d,avgComments:f,mostUsedTags:g.slice(0,3),lastScanOn:Date.now()}}))}var qo={init:function(){Io.init(),Fo.init()}};!async function(){window._=M().default,s().polyfillsController.init();const a=Te.getVersion();console.log("chrome version is: "+a),t().logController.init(),await Xt.init(),z().sentryController.init({dsn:"https://bea0900834f541bca8157710f7fd31fe@sentry.io/1547551"}),e().i18nController.init(),Ce.init(),Oe.init(),f().abTestingController.init(),go.init(),await d().synchController.init("background",!0),co.init(),pe.init(),et.init(),Zt.init(),ot.init(),ft.init(),Jt.init(),Ze.init(),po.init(),mo.init(),we.init(),qo.init(),C().gaController.init().sendPageview().sendInstall(),_e.init(),await _e.updateUser(),he.init(),await he.updatePro(),fo.init(),ho.init(),window._backgroundReady=!0}()}();